{"version":3,"file":"RefreshableLayer-B9PbZU9W.js","sources":["../../node_modules/@arcgis/core/layers/mixins/refresh.js","../../node_modules/@arcgis/core/layers/mixins/RefreshableLayer.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Collection.js\";import{sync as r}from\"../../core/reactiveUtils.js\";import{autorun as t}from\"../../core/accessorSupport/trackingUtils.js\";const n=new e,o=new WeakMap;function f(e){i(e)&&n.push(new WeakRef(e))}function s(e){const r=n.find(r=>r.deref()===e);r&&n.remove(r)}function i(e){return null!=e&&\"object\"==typeof e&&\"refreshInterval\"in e&&\"refresh\"in e}function c(e,r){return Number.isFinite(e)&&Number.isFinite(r)?r<=0?e:c(r,e%r):0}let l=0,a=0;function u(){const e=Date.now();let r=!1;for(const t of n){const n=t.deref();if(n){if(n.refreshInterval){e-(o.get(n)??0)+5>=6e4*n.refreshInterval&&(o.set(n,e),n.refresh(e))}}else r=!0}if(r)for(let t=n.length-1;t>=0;t--){n.at(t).deref()||n.removeAt(t)}}t(()=>{const e=Date.now();let r=0;for(const t of n){const n=t.deref();n&&(r=c(Math.round(6e4*n.refreshInterval),r),n.refreshInterval?o.get(n)||o.set(n,e):o.delete(n))}if(r!==a){if(a=r,clearInterval(l),0===a)return void(l=0);l=setInterval(u,a)}},r);const h={get hasRefreshTimer(){return l>0},get tickInterval(){return a},forceRefresh(){u()},hasLayer:e=>i(e)&&n.some(r=>r.deref()===e),clear(){for(const e of n){const r=e.deref();r&&o.delete(r)}n.removeAll()}};export{f as registerLayer,h as test,s as unregisterLayer};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{__decorate as e}from\"tslib\";import\"../../core/has.js\";import r from\"../../core/Logger.js\";import{debounce as t,ignoreAbortErrors as s}from\"../../core/promiseUtils.js\";import{property as o}from\"../../core/accessorSupport/decorators/property.js\";import{cast as a}from\"../../core/accessorSupport/decorators/cast.js\";import\"../../core/RandomLCG.js\";import{subclass as i}from\"../../core/accessorSupport/decorators/subclass.js\";import{excludeTables as n}from\"../../core/accessorSupport/layerContainerType.js\";import{registerLayer as h,unregisterLayer as p}from\"./refresh.js\";function m(e){return null!=e&&\"object\"==typeof e&&\"refreshTimestamp\"in e&&\"refresh\"in e}const c=.1,f=m=>{const f=m;let l=class extends f{constructor(...e){super(...e),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=t(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||h(this)},()=>{})}destroy(){p(this)}castRefreshInterval(e){return e>=c?e:e<=0?0:c}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(e=Date.now()){s(this._debounceHasDataChanged()).then(r=>{r&&this._set(\"refreshTimestamp\",e),this.emit(\"refresh\",{dataChanged:r})},e=>{r.getLogger(this).error(e),this.emit(\"refresh\",{dataChanged:!1,error:e})})}async hasDataChanged(){return!0}get test(){}};return e([o({type:Number,json:{write:!0,origins:{\"web-scene\":{write:{enabled:!0,layerContainerTypes:n}}}}})],l.prototype,\"refreshInterval\",void 0),e([a(\"refreshInterval\")],l.prototype,\"castRefreshInterval\",null),e([o({readOnly:!0})],l.prototype,\"refreshTimestamp\",void 0),e([o({readOnly:!0})],l.prototype,\"refreshParameters\",null),l=e([i(\"esri.layers.mixins.RefreshableLayer\")],l),l};export{f as RefreshableLayer,m as isRefreshableLayer};\n"],"names":["n","e","o","f","i","s","r","c","a","u","t","m","l","h","p"],"mappings":"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","x_google_ignoreList":[0,1]}
{"version":3,"file":"RasterWorker-OeSIifmY.js","sources":["../../node_modules/@arcgis/core/layers/support/rasterTransforms/IdentityTransform.js","../../node_modules/@arcgis/core/layers/support/rasterTransforms/utils.js","../../node_modules/@arcgis/core/layers/support/RasterWorker.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{__decorate as r}from\"tslib\";import\"../../../core/Logger.js\";import\"../../../core/has.js\";import\"../../../core/RandomLCG.js\";import\"../../../core/Error.js\";import{enumeration as o}from\"../../../core/accessorSupport/decorators/enumeration.js\";import{subclass as t}from\"../../../core/accessorSupport/decorators/subclass.js\";import s from\"./BaseRasterTransform.js\";var e;let p=e=class extends s{constructor(){super(...arguments),this.type=\"identity\"}clone(){return new e}};r([o({IdentityXform:\"identity\"})],p.prototype,\"type\",void 0),p=e=r([t(\"esri.layers.support.rasterTransforms.IdentityTransform\")],p);export{p as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport r from\"./GCSShiftTransform.js\";import o from\"./IdentityTransform.js\";import t from\"./PolynomialTransform.js\";const n={GCSShiftXform:r,IdentityXform:o,PolynomialXform:t};function f(r){const o=r?.type;if(!o)return null;const t=n[r?.type];if(t){const o=new t;return o.read(r),o}return null}export{f as readTransform};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport e from\"../../geometry/Extent.js\";import r from\"../../geometry/Point.js\";import t from\"../../geometry/operators/support/GeographicTransformation.js\";import s from\"./PixelBlock.js\";import{decode as o}from\"./rasterFormats/RasterCodec.js\";import{convertPixelBlockToFeatures as i,highlightPixels as n,split as l,clipTile as a,mosaic as m,approximateTransform as c,getLocalArithmeticNorthRotations as f}from\"./rasterFunctions/pixelUtils.js\";import{create as p}from\"./rasterFunctions/rasterFunctionHelper.js\";import{load as u,getProjectionOffsetGrid as S}from\"./rasterFunctions/rasterProjectionHelper.js\";import{computeStatisticsHistograms as d,estimateStatisticsHistograms as x}from\"./rasterFunctions/stretchUtils.js\";import{convertVectorFieldData as h,convertToLocalDirections as g}from\"./rasterFunctions/vectorFieldUtils.js\";import{readTransform as y}from\"./rasterTransforms/utils.js\";import O from\"../../renderers/support/RasterSymbolizer.js\";import{createFlowMesh as k}from\"../../views/2d/engine/flow/dataUtils.js\";function B(e){if(!e)return{result:null,transferList:[]};const{pixelBlock:r,transferList:t}=e.getTransferableObject();return{result:r,transferList:t}}class N{convertVectorFieldData(e){const r=s.fromJSON(e.pixelBlock),t=B(h(r,e.type));return Promise.resolve(t)}convertPixelBlockToFeatures(r){const t=i({pixelBlock:s.fromJSON(r.pixelBlock),extent:e.fromJSON(r.extent),fieldNames:r.fieldNames,skipFactor:r.skipFactor,skipSpatialReference:!0,pixelIdOffset:r.pixelIdOffset,imageRowSize:r.imageRowSize});return Promise.resolve(t)}computeStatisticsHistograms(e){const r=s.fromJSON(e.pixelBlock),t=d(r,{histogramSize:e.histogramSize,includeSkewnessKurtosis:e.includeSkewnessKurtosis});return Promise.resolve(t)}async decode(e){return B(await o(e.data,e.options))}symbolize(r){r.pixelBlock=s.fromJSON(r.pixelBlock),r.extent=r.extent?e.fromJSON(r.extent):null;const t=B(this.symbolizer.symbolize(r));return Promise.resolve(t)}highlightPixels(e){const r=s.fromJSON(e.pixelBlock),t=s.fromJSON(e.renderedPixelBlock);return n(r,t,e.highlightOptions),Promise.resolve(t.toJSON())}async updateSymbolizer(e){this.symbolizer=O.fromJSON(e.symbolizerJSON),e.histograms&&\"rasterStretch\"===this.symbolizer?.rendererJSON.type&&(this.symbolizer.rendererJSON.histograms=e.histograms)}async updateRasterFunction(e){this.rasterFunction=p(e.rasterFunctionJSON)}async process(t){return B(this.rasterFunction.process({extent:e.fromJSON(t.extent),primaryPixelBlocks:t.primaryPixelBlocks.map(e=>null!=e?s.fromJSON(e):null),primaryPixelSizes:t.primaryPixelSizes?.map(e=>null!=e?r.fromJSON(e):null),primaryRasterIds:t.primaryRasterIds}))}stretch(e){const r=B(this.symbolizer.simpleStretch(s.fromJSON(e.srcPixelBlock),e.stretchParams));return Promise.resolve(r)}estimateStatisticsHistograms(e){const r=x(s.fromJSON(e.srcPixelBlock));return Promise.resolve(r)}split(e){const r=l(s.fromJSON(e.srcPixelBlock),e.tileSize,e.maximumPyramidLevel??0,!1===e.useBilinear),t=[];let o;return r&&(o=new Map,r.forEach((e,r)=>{if(e){const{pixelBlock:s,transferList:i}=e.getTransferableObject();o.set(r,s),i.forEach(e=>{t.includes(e)||t.push(e)})}})),Promise.resolve({result:o,transferList:t})}clipTile(e){const r=s.fromJSON(e.pixelBlock),t=B(a({...e,pixelBlock:r}));return Promise.resolve(t)}async mosaicAndTransform(e){const r=e.srcPixelBlocks.map(e=>e?new s(e):null),t=m(r,e.srcMosaicSize,{blockWidths:e.blockWidths,alignmentInfo:e.alignmentInfo,clipOffset:e.clipOffset,clipSize:e.clipSize});let o,i=t;e.coefs&&(i=c(t,e.destDimension,e.coefs,e.sampleSpacing,e.interpolation)),e.projectDirections&&e.gcsGrid&&(o=f(e.destDimension,e.gcsGrid),i=g(i,e.isUV?\"vector-uv\":\"vector-magdir\",o));const{result:n,transferList:l}=B(i);return{result:{pixelBlock:n,localNorthDirections:o},transferList:l}}async createFlowMesh(e,r){const t={data:new Float32Array(e.flowData.buffer),mask:new Uint8Array(e.flowData.maskBuffer),width:e.flowData.width,height:e.flowData.height},{vertexData:s,indexData:o}=await k(e.meshType,e.simulationSettings,t,r.signal);return{result:{vertexBuffer:s.buffer,indexBuffer:o.buffer},transferList:[s.buffer,o.buffer]}}async getProjectionOffsetGrid(r){const s=e.fromJSON(r.projectedExtent),o=e.fromJSON(r.srcBufferExtent);let i=null;r.datumTransformationSteps?.length&&(i=new t({steps:r.datumTransformationSteps})),await u();const n=r.rasterTransform?y(r.rasterTransform):null;return S({...r,projectedExtent:s,srcBufferExtent:o,datumTransformation:i,rasterTransform:n})}}export{N as default};\n"],"names":["e","p","s","r","o","t","n","f","B","N","h","i","d","O","x","l","a","m","c","g","k","u","y","S"],"mappings":"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","x_google_ignoreList":[0,1,2]}
{"version":3,"file":"StreamLayerView2D-WeOd3ySD.js","sources":["../../node_modules/@arcgis/core/views/layers/StreamLayerView.js","../../node_modules/@arcgis/core/views/2d/layers/StreamLayerView2D.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{__decorate as s}from\"tslib\";import{property as e}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/Logger.js\";import\"../../core/RandomLCG.js\";import{subclass as t}from\"../../core/accessorSupport/decorators/subclass.js\";import o from\"../../layers/support/FeatureFilter.js\";const r=r=>{const i=r;let n=class extends i{resume(){this._isUserPaused=!1,this.suspended||this._doResume()}pause(){this._isUserPaused=!0,this.suspended||this._doPause()}disconnect(){this._doDisconnect()}connect(){this._doConnect()}clear(){this._doClear()}constructor(...s){super(...s),this._isUserPaused=!1,this.filter=null}get connectionStatus(){return(this._isUserPaused||this.suspended)&&\"connected\"===this._streamConnectionStatus?\"paused\":this._streamConnectionStatus}_onSuspendedChange(s){s?this._doPause():this._isUserPaused||this._doResume()}};return s([e()],n.prototype,\"_isUserPaused\",void 0),s([e({readOnly:!0})],n.prototype,\"connectionStatus\",null),s([e({type:o})],n.prototype,\"filter\",void 0),n=s([t(\"esri.views.layers.StreamLayerView\")],n),n};export{r as StreamLayerView};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{__decorate as e}from\"tslib\";import r from\"../../../core/Error.js\";import{handlesGroup as t,makeHandle as s}from\"../../../core/handleUtils.js\";import{watch as n}from\"../../../core/reactiveUtils.js\";import{property as o}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/Logger.js\";import\"../../../core/RandomLCG.js\";import{subclass as i}from\"../../../core/accessorSupport/decorators/subclass.js\";import a from\"../../../rest/support/FeatureSet.js\";import{isNumber as c}from\"../../../support/guards.js\";import l from\"./FeatureLayerView2D.js\";import{handleNoEngineError as h}from\"./support/handleNoEngineError.js\";import{StreamLayerView as p}from\"../../layers/StreamLayerView.js\";let u=class extends(p(l)){constructor(){super(...arguments),this.pipelineConnectionStatus=\"disconnected\",this.pipelineErrorString=null}initialize(){this.addHandles([n(()=>this.layer.customParameters,async e=>{(await this.getWorker()).streamMessenger.updateCustomParameters(e)}),this.layer.on(\"send-message-to-socket\",async e=>{(await this.getWorker()).streamMessenger.sendMessageToSocket(e)}),this.layer.on(\"send-message-to-client\",async e=>{(await this.getWorker()).streamMessenger.sendMessageToClient(e),this._isUserPaused&&\"type\"in e&&\"clear\"===e.type&&this.incrementSourceRefreshVersion()}),n(()=>this.layer.purgeOptions,()=>this._update()),n(()=>this.suspended,this._onSuspendedChange.bind(this))],\"constructor\"),this._doResume()}destroy(){this._doPause()}get connectionError(){return this.pipelineErrorString?new r(\"stream-controller\",this.pipelineErrorString):null}on(e,r){if(Array.isArray(e))return t(e.map(e=>this.on(e,r)));const n=[\"data-received\",\"message-received\"].includes(e);n&&this.getWorker().then(r=>r.streamMessenger.enableEvent(e,!0));const o=super.on(e,r),i=this;return s(()=>{o.remove(),n&&(i._workerProxy.closed||i.hasEventListener(e)||i.getWorker().then(r=>r.streamMessenger.enableEvent(e,!1)))})}async queryLatestObservations(e,t){if(!(this.layer.timeInfo?.endField||this.layer.timeInfo?.startField||this.layer.timeInfo?.trackIdField))throw new r(\"streamlayer-no-timeField\",\"queryLatestObservation can only be used with services that define a TrackIdField\");const s=await this.getWorker();return h(s.features.executeQueryForLatestObservations(this._cleanUpQuery(e),t).then(e=>{const r=a.fromJSON(e);return r.features.forEach(e=>{e.layer=this.layer,e.sourceLayer=this.layer,e.origin=this.layer.graphicOrigin}),r}),new a({features:[]}))}detach(){super.detach(),this.pipelineConnectionStatus=\"disconnected\"}async queryObjectIds(e,r){return(await super.queryObjectIds(e,r)).filter(c)}get _streamConnectionStatus(){return this.pipelineConnectionStatus}_doPause(){null!=this._refreshInterval&&(clearInterval(this._refreshInterval),this._refreshInterval=null)}_doResume(){null==this._refreshInterval&&(this._refreshInterval=setInterval(()=>this.incrementSourceRefreshVersion(),this.layer.updateInterval))}_doDisconnect(){this.getWorker().then(e=>e.streamMessenger.disconnect()),this._doPause()}_doConnect(){this.getWorker().then(e=>e.streamMessenger.connect()),this.resume()}_doClear(){this.getWorker().then(e=>e.streamMessenger.clear()),null==this._refreshInterval&&this.incrementSourceRefreshVersion()}_createClientOptions(){const e=super._createClientOptions(),r=this;return{...e,get container(){return r.featureContainer},setProperty:e=>{this.set(e.propertyName,e.value)}}}};e([o()],u.prototype,\"pipelineConnectionStatus\",void 0),e([o()],u.prototype,\"pipelineErrorString\",void 0),e([o({readOnly:!0})],u.prototype,\"connectionError\",null),e([o({readOnly:!0})],u.prototype,\"_streamConnectionStatus\",null),u=e([i(\"esri.views.2d.layers.StreamLayerView2D\")],u);const d=u;export{d as default};\n"],"names":["r","i","n","s","e","o","t","u","p","l","h","a","c","d"],"mappings":"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","x_google_ignoreList":[0,1]}
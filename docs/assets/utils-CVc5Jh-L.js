import{cg as T,c5 as Z,c6 as c,bv as m,ch as w,ci as C,cj as S,a9 as $,ck as U,cl as v,aC as D,ae as p}from"./index-CaU30Hkv.js";const M=",",F={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864e5},N=new Set(["integer","small-integer"]);let d=null;function x(e){return $(e)||U(e)||v(e)}async function E(e){const{field:n,field2:t,field3:a,normalizationField:r,valueExpression:u,fields:i}=e;let o=[];if(u){if(!d){const{arcadeUtils:l}=await D();d=l}o=d.extractFieldNames(u)}return n&&o.push(n),t&&o.push(t),a&&o.push(a),r&&o.push(r),i&&o.push(...i),o}function f(e){return String(e).padStart(2,"0")}function h(e,n,t){let a;return n==="date"||n==="number"?(n==="number"&&(e=new Date(e)),a=`TIMESTAMP'${t?e.getFullYear():e.getUTCFullYear()}-${f((t?e.getMonth():e.getUTCMonth())+1)}-${f(t?e.getDate():e.getUTCDate())} ${f(t?e.getHours():e.getUTCHours())}:${f(t?e.getMinutes():e.getUTCMinutes())}:${f(t?e.getSeconds():e.getUTCSeconds())}'`):a=e,a}function I(e,n,t,a){const{hasQueryEngine:r}=e,u=`(${h(t,y(e,t),r)} - ${h(n,y(e,n),r)})`;let i=F[a],o="/";return i<1&&(i=1/i,o="*"),{sqlExpression:i===1?u:`(${u} ${o} ${i})`,sqlWhere:null}}function y(e,n){if(n instanceof Date)return"date";if(typeof n=="number")return"number";if(typeof n=="string"){const t=e.getField(n);if(n.toLowerCase()==="<now>")return;if($(t))return"field"}}function k(e,n){const t=n&&e.getField(n);return!!t&&N.has(t.type)}function q(e){return`cast(${e} as float)`}function z(e,n){const{format:t,fieldFormat:a,timeZoneOptions:r,fieldType:u}=n??{},i=a?T(a):null;let o,l;if(r&&({timeZone:o,timeZoneName:l}=Z(r.layerTimeZone,r.datesInUnknownTimezone,r.viewTimeZone,i||c(t||"short-date-short-time"),u)),typeof e=="string"&&isNaN(Date.parse(u==="time-only"?`1970-01-01T${e}Z`:e)))return e;switch(u){case"date-only":{const s=i||c(t||"short-date");return typeof e=="string"?S(e,{...s}):m(e,{...s,timeZone:p})}case"time-only":{const s=i||c(t||"short-time");return typeof e=="string"?C(e,s):m(e,{...s,timeZone:p})}case"timestamp-offset":{if(!o&&typeof e=="string"&&new Date(e).toISOString()!==e)return e;const s=t||i||r?i||c(t||"short-date-short-time"):void 0,g=s?{...s,timeZone:o,timeZoneName:l}:void 0;return typeof e=="string"?w(e,g):m(e,g)}default:{const s=t||i||r?i||c(t||"short-date-short-time"):void 0;return m(typeof e=="string"?new Date(e):e,s?{...s,timeZone:o,timeZoneName:l}:void 0)}}}export{I as C,k as M,q as N,x as U,M as c,E as w,z as x};
//# sourceMappingURL=utils-CVc5Jh-L.js.map

{"version":3,"file":"RouteLayerInteraction-DGR5uRCC.js","sources":["../../node_modules/@arcgis/core/views/2d/layers/support/RouteLayerInteraction.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{__decorate as e}from\"tslib\";import r from\"../../../../core/Accessor.js\";import{destroyHandle as t}from\"../../../../core/handleUtils.js\";import{destroyMaybe as o}from\"../../../../core/maybe.js\";import{watch as s,initial as i}from\"../../../../core/reactiveUtils.js\";import{property as a}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/Logger.js\";import\"../../../../core/RandomLCG.js\";import{subclass as l}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{UpdatingHandles as p}from\"../../../../core/support/UpdatingHandles.js\";import n from\"../../../../layers/GraphicsLayer.js\";import c from\"../../../../rest/support/PointBarrier.js\";import h from\"../../../../rest/support/PolygonBarrier.js\";import y from\"../../../../rest/support/PolylineBarrier.js\";import d from\"../../../../rest/support/Stop.js\";import m from\"../../../../widgets/Sketch/SketchViewModel.js\";function g(e,r){e.networkFeature=r}function u(e){const r=w(e.graphic);return{...e,networkFeature:r}}function b(e){const r=e.graphics.map(e=>w(e));return{...e,networkFeatures:r}}function w(e){return e.networkFeature}function k(e){return\"point\"===e?.type||\"polyline\"===e?.type||\"polygon\"===e?.type}let _=class extends r{constructor(e){super(e),this._createMode=null,this._graphicsLayer=new n({internal:!0,listMode:\"hide\",title:\"RouteLayerInteraction layer\"}),this._updatingHandles=new p,this.enabled=!0,this._handleSketchViewModelEvents=async e=>{switch(e.type){case\"update\":switch(e.state){case\"active\":case\"complete\":for(const r of e.graphics){w(r).geometry=k(r.geometry)?r.geometry.clone():null}}break;case\"undo\":case\"redo\":break;case\"delete\":for(const r of e.graphics){const e=w(r);this._removeNetworkFeature(e)}break;case\"create\":if(e.graphic&&\"complete\"===e.state&&this._createMode){const r=e.graphic.geometry?.clone(),t=e.graphic.symbol?.clone();if(!r)break;switch(this._createMode){case\"stop\":{if(\"point\"!==r.type)break;const{stops:t}=this.layer;if(t.length>0&&t.every(({geometry:e})=>!e)){t.at(0).geometry=r;break}if(t.length>1&&t.filter((e,r)=>0!==r).every(({geometry:e})=>!e)){t.at(1).geometry=r;break}const o=new d({geometry:r});t.add(o),g(e.graphic,o);break}case\"point-barrier\":{if(\"point\"!==r.type)break;const o=new c({geometry:r,symbol:t});this.layer.pointBarriers.add(o),g(e.graphic,o);break}case\"polyline-barrier\":{if(\"polyline\"!==r.type)break;const o=new y({geometry:r,symbol:t});this.layer.polylineBarriers.add(o),g(e.graphic,o);break}case\"polygon-barrier\":{if(\"polygon\"!==r.type)break;const o=new h({geometry:r,symbol:t});this.layer.polygonBarriers.add(o),g(e.graphic,o);break}}}}(await this.view.whenLayerView(this.layer)).emit(e.type,\"create\"===e.type?u(e):b(e))}}initialize(){this._sketchViewModel=new m({layer:this._graphicsLayer,view:this.view}),this.addHandles([s(()=>this.enabled,e=>{e?this._activate():this._deactivate()},i),s(()=>{const{stops:e,pointBarriers:r,polylineBarriers:t,polygonBarriers:o}=this.layer;return{stops:e,pointBarriers:r,polylineBarriers:t,polygonBarriers:o}},()=>{this.enabled&&this._loadClonedGraphics()}),this._sketchViewModel.on([\"create\",\"delete\",\"redo\",\"undo\",\"update\"],this._handleSketchViewModelEvents),t(this._updatingHandles)])}destroy(){this.view.map.remove(this._graphicsLayer),this._graphicsLayer.removeAll(),this._graphicsLayer=o(this._graphicsLayer),this._sketchViewModel=o(this._sketchViewModel)}get selectedNetworkFeatures(){return this._sketchViewModel.updateGraphics.map(e=>w(e))}get updating(){return this._updatingHandles.updating}create(e){switch(this._createMode=e,e){case\"stop\":this.layer.defaultSymbols.stops?.unlocated&&(this._sketchViewModel.pointSymbol=this.layer.defaultSymbols.stops.unlocated.clone());break;case\"point-barrier\":this.layer.defaultSymbols.pointBarriers&&(this._sketchViewModel.pointSymbol=this.layer.defaultSymbols.pointBarriers.clone());break;case\"polyline-barrier\":this.layer.defaultSymbols.polylineBarriers&&(this._sketchViewModel.polylineSymbol=this.layer.defaultSymbols.polylineBarriers.clone());break;case\"polygon-barrier\":this.layer.defaultSymbols.polygonBarriers&&(this._sketchViewModel.polygonSymbol=this.layer.defaultSymbols.polygonBarriers.clone())}switch(e){case\"stop\":case\"point-barrier\":return this._sketchViewModel.create(\"point\");case\"polyline-barrier\":return this._sketchViewModel.create(\"polyline\");case\"polygon-barrier\":return this._sketchViewModel.create(\"polygon\")}}remove(e){const r=this._graphicsLayer.graphics.find(r=>w(r)===e);r&&this._graphicsLayer.remove(r),this._removeNetworkFeature(e)}_activate(){this._loadClonedGraphics(),this.view.map.add(this._graphicsLayer)}_deactivate(){this._sketchViewModel.cancel(),this.view.map?.remove(this._graphicsLayer),this._graphicsLayer.removeAll()}_loadClonedGraphics(){const e=[this.layer.stops,this.layer.pointBarriers,this.layer.polylineBarriers,this.layer.polygonBarriers].flatMap(e=>e.toArray().map(e=>{const r=e.toGraphic();return r.networkFeature=e,r}));this._graphicsLayer.removeAll().addMany(e)}_removeNetworkFeature(e){switch(e.type){case\"stop\":this.layer.stops.remove(e);break;case\"point-barrier\":this.layer.pointBarriers.remove(e);break;case\"polyline-barrier\":this.layer.polylineBarriers.remove(e);break;case\"polygon-barrier\":this.layer.polygonBarriers.remove(e)}}};e([a()],_.prototype,\"enabled\",void 0),e([a({constructOnly:!0})],_.prototype,\"layer\",void 0),e([a({readOnly:!0})],_.prototype,\"selectedNetworkFeatures\",null),e([a()],_.prototype,\"updating\",null),e([a({constructOnly:!0})],_.prototype,\"view\",void 0),_=e([l(\"esri.views.2d.layers.support.RouteLayerInteraction\")],_);export{_ as RouteLayerInteraction};\n"],"names":["g","u","w","b","e","k","_","r","n","p","t","o","d","c","y","h","m","s","i","a","l"],"mappings":"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","x_google_ignoreList":[0]}
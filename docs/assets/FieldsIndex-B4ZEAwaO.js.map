{"version":3,"file":"FieldsIndex-B4ZEAwaO.js","sources":["../../node_modules/@arcgis/core/layers/support/FieldsIndex.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";import i from\"../../core/Logger.js\";import{getOrCreateMapValue as t}from\"../../core/MapUtils.js\";import{UnknownTimeZone as s}from\"../../core/sql/UnknownTimeZone.js\";import{isSerializable as n}from\"../../core/support/jsonUtils.js\";import{isDateField as r,isNumericField as l,isObjectIDField as o,isGlobalIDField as d,getFieldDefaultValue as a,isTimeOnlyField as m,normalizeFieldName as u}from\"./fieldUtils.js\";import{utc as f,unknown as F}from\"../../time/constants.js\";import{fromTimeReference as h}from\"../../time/timeZoneUtils.js\";import{FixedOffsetZone as c,IANAZone as p}from\"luxon\";function y(e){return\"timeZone\"in e}function _(e){return\"timeZone\"in e}function g(e){return\"dateFieldsTimeZone\"in e}const T=new Map;class Z{static fromJSON(e){return new Z(e.fields,e.timeZoneByFieldName)}static fromLayer(e){return new Z(e.fields??[],S(e))}static fromLayerJSON(e){return new Z(e.fields??[],S(e))}constructor(e=[],i){this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this._requiredFields=null,this.dateFields=[],this.numericFields=[],this.fields=e||[],this._timeZoneByFieldName=i?new Map(i):null;const t=[];for(const s of this.fields){const e=s?.name,i=M(e);if(e&&i){const n=w(e);this._fieldsMap.set(e,s),this._fieldsMap.set(n,s),this._normalizedFieldsMap.set(i,s),t.push(`${n}:${s.type}:${this._timeZoneByFieldName?.get(e)}`),r(s)?(this.dateFields.push(s),this._dateFieldsSet.add(s)):l(s)&&(this._numericFieldsSet.add(s),this.numericFields.push(s)),o(s)||d(s)||(s.editable=null==s.editable||!!s.editable,s.nullable=null==s.nullable||!!s.nullable)}}t.sort(),this.uid=t.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)o(e)||d(e)||e.nullable||void 0!==a(e)||this._requiredFields.push(e)}return this._requiredFields}equals(e){return this.uid===e?.uid}has(e){return null!=this.get(e)}get(e){if(!e)return;let i=this._fieldsMap.get(e);return i||(i=this._fieldsMap.get(w(e))??this._normalizedFieldsMap.get(M(e)),i&&this._fieldsMap.set(e,i),i)}getTimeZone(t){const s=this.get(t&&\"string\"!=typeof t?t.name:t);return s?this._timeZoneByFieldName?this._timeZoneByFieldName.get(s.name):\"date\"===s.type||\"esriFieldTypeDate\"===s.type?(i.getLogger(\"esri.layers.support.FieldsIndex\").errorOnce(new e(\"getTimeZone:no-timezone-information\",`no time zone information for field '${s.name}'`)),f):N.has(s.type)?F:null:null}getLuxonTimeZone(e){const i=this.getTimeZone(e);return i?i===F?s.instance:i===f?c.utcInstance:t(T,i,()=>p.create(i)):null}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isTimeOnlyField(e){return m(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){return this.get(e)?.name??void 0}toJSON(){return{fields:this.fields.map(e=>n(e)?e.toJSON():e),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}}function w(e){return e.trim().toLowerCase()}function M(e){return u(e)?.toLowerCase()??\"\"}const N=new Set([\"time-only\",\"date-only\",\"timestamp-offset\",\"esriFieldTypeDateOnly\",\"esriFieldTypeTimeOnly\",\"esriFieldTypeTimestampOffset\"]);function S(e){const i=new Map;if(!e.fields)return i;const t=!0===e.datesInUnknownTimezone,{timeInfo:s,editFieldsInfo:n}=e,r=(s?\"startField\"in s?s.startField:s.startTimeField:\"\")??\"\",l=(s?\"endField\"in s?s.endField:s.endTimeField:\"\")??\"\",o=g(e)?e.dateFieldsTimeZone??null:e.dateFieldsTimeReference?h(e.dateFieldsTimeReference):null,d=n?y(n)?n.timeZone??o:n.dateFieldsTimeReference?h(n.dateFieldsTimeReference):o??f:null,a=s?_(s)?s.timeZone??o:s.timeReference?h(s.timeReference):o:null,m=new Map([[w(n?.creationDateField??\"\"),d],[w(n?.editDateField??\"\"),d],[w(r),a],[w(l),a]]);for(const{name:u,type:f}of e.fields)if(N.has(f))i.set(u,F);else if(\"date\"!==f&&\"esriFieldTypeDate\"!==f)i.set(u,null);else if(t)i.set(u,F);else{const e=m.get(w(u??\"\"))??o;i.set(u,e)}return i}export{Z as default};\n"],"names":["y","e","_","g","T","Z","S","i","t","s","M","n","w","r","l","o","d","a","f","N","F","c","p","m","u","h"],"mappings":"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","x_google_ignoreList":[0]}
{"version":3,"file":"SceneLayerSnappingSourceWorker-BlIas6xh.js","sources":["../../node_modules/@arcgis/core/views/interactive/snapping/featureSources/sceneLayerSource/sceneLayerSnappingUtils.js","../../node_modules/@arcgis/core/views/interactive/snapping/featureSources/sceneLayerSource/SceneLayerSnappingSourceWorker.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{h as s,c as o,k as r,g as c}from\"../../../../../chunks/vec32.js\";import{create as t}from\"../../../../../core/libs/gl-matrix-2/factories/vec3f64.js\";import{j as e}from\"../../../../../chunks/sphere.js\";const n=1e3;function a(t,n,a){const m=i;s(m,t,.5),o(m,m,n,.5);const f=r(m,t);return c(m,m,a),e(m,f)}const i=t();export{a as boundsFromEdge,n as maxCandidateCount};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{__decorate as e}from\"tslib\";import{throwIfAborted as t}from\"../../../../../core/promiseUtils.js\";import\"../../../../../core/Logger.js\";import\"../../../../../core/has.js\";import\"../../../../../core/RandomLCG.js\";import\"../../../../../core/Error.js\";import{subclass as o}from\"../../../../../core/accessorSupport/decorators/subclass.js\";import{g as s,k as n}from\"../../../../../chunks/vec32.js\";import{create as i,clone as r}from\"../../../../../core/libs/gl-matrix-2/factories/vec3f64.js\";import{create as c,fromPoints as d,projectPoint as a}from\"../../../../../geometry/support/lineSegment.js\";import{n as p,B as m,a as u}from\"../../../../../chunks/sphere.js\";import{Octree as h}from\"../../../../3d/webgl-engine/lib/Octree.js\";import{extractComponentsEdgeLocationsLayout as g}from\"../../../../3d/webgl-engine/lib/edgeRendering/edgeProcessing.js\";import{maxCandidateCount as l,boundsFromEdge as f}from\"./sceneLayerSnappingUtils.js\";let _=class{constructor(){this._idToComponent=new Map,this._components=new h(e=>e.bounds),this._edges=new h(e=>e.bounds),this._tmpLineSegment=c(),this._tmpP1=i(),this._tmpP2=i(),this._tmpP3=i(),this.remoteClient=null}async fetchCandidates(e,o){await Promise.resolve(),t(o),await this._ensureEdgeLocations(e,o);const s=[];return this._edges.forEachNeighbor(t=>(this._addCandidates(e,t,s),s.length<l),e.bounds),{result:{candidates:s}}}async _ensureEdgeLocations(e,t){const o=[];if(this._components.forEachNeighbor(e=>{if(null==e.info){const{id:t,uid:s}=e;o.push({id:t,uid:s})}return!0},e.bounds),!o.length)return;const s={components:o},n=await this.remoteClient.invoke(\"fetchAllEdgeLocations\",s,t??{});for(const i of n.components)this._setFetchEdgeLocations(i)}async add(e){const t=new w(e.id,e.bounds);return this._idToComponent.set(t.id,t),this._components.add([t]),{result:{}}}async remove(e){const t=this._idToComponent.get(e.id);if(t){const e=[];this._edges.forEachNeighbor(o=>(o.component===t&&e.push(o),!0),t.bounds),this._edges.remove(e),this._components.remove([t]),this._idToComponent.delete(t.id)}return{result:{}}}_setFetchEdgeLocations(e){const t=this._idToComponent.get(e.id);if(null==t||e.uid!==t.uid)return;const o=g.createView(e.locations),s=new Array(o.count),n=i(),r=i();for(let i=0;i<o.count;i++){o.position0.getVec(i,n),o.position1.getVec(i,r);const c=f(n,r,e.origin),d=new C(t,i,c);s[i]=d}this._edges.add(s);const{objectIds:c,origin:d}=e;t.info={locations:o,objectIds:c,origin:d}}_addCandidates(e,t,o){const{info:n}=t.component,{origin:i,objectIds:r}=n,c=n.locations,d=c.position0.getVec(t.index,this._tmpP1),a=c.position1.getVec(t.index,this._tmpP2);s(d,d,i),s(a,a,i);const p=r[c.componentIndex.get(t.index)];this._addEdgeCandidate(e,p,d,a,o),j(e,p,d,o),j(e,p,a,o)}_addEdgeCandidate(e,t,o,s,i){if(!e.returnEdge)return;const c=p(e.bounds,E),u=d(o,s,this._tmpLineSegment),h=a(u,c,this._tmpP3);m(e.bounds,h)&&i.push({type:\"edge\",objectId:t,target:r(h),distance:n(c,h),start:r(o),end:r(s)})}};_=e([o(\"esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker\")],_);const b=_;function j(e,t,o,s){e.returnVertex&&m(e.bounds,o)&&s.push({type:\"vertex\",objectId:t,target:r(o),distance:n(u(e.bounds),o)})}class w{constructor(e,t){this.id=e,this.bounds=t,this.info=null,this.uid=++w.uid}static{this.uid=0}}class C{constructor(e,t,o){this.component=e,this.index=t,this.bounds=o}}const E=i();export{b as default};\n"],"names":["n","a","m","i","s","o","f","r","c","e","t","_","h","l","w","g","d","C","j","p","E","u","b","_w"],"mappings":"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","x_google_ignoreList":[0,1]}
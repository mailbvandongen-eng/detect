{"version":3,"file":"kansenkaartOL-BvUN83r8.js","sources":["../../src/layers/kansenkaartOL.ts"],"sourcesContent":["/**\n * Kansenkaart - Predictive Archaeological Expectation Map\n *\n * Combines multiple data sources to create a weighted heatmap showing\n * areas with high archaeological potential based on:\n *\n * 1. LANDSCAPE (geomorfologie) - where people COULD live:\n *    - Stroomruggen, oeverwallen (dry elevated river areas)\n *    - Rivierduinen (river dunes)\n *    - Dekzandruggen (cover sand ridges)\n *    - Terpen/wierden (artificial dwelling mounds)\n *\n * 2. FINDS - where people DID live:\n *    - AMK Monumenten (known archaeological sites)\n *    - Grafheuvels (burial mounds)\n *    - Hunebedden (megalithic tombs)\n *    - Steentijd sites (prehistoric settlements)\n *\n * The edges of hotspots indicate areas likely to contain undiscovered sites.\n */\n\nimport { Feature } from 'ol'\nimport { Point } from 'ol/geom'\nimport { Vector as VectorSource } from 'ol/source'\nimport { Heatmap as HeatmapLayer } from 'ol/layer'\nimport GeoJSON from 'ol/format/GeoJSON'\nimport { fromLonLat } from 'ol/proj'\nimport { loadTopoJSON, parseGeoJSON } from '../utils/layerLoaderOL'\n\n// Weight configuration for different feature types\nconst WEIGHTS = {\n  // Geomorfologie - landscape potential (where people COULD live)\n  geomorf_zeer_hoog: 1.0,   // Stroomruggen, oeverwallen, rivierduinen, terpen\n  geomorf_hoog: 0.8,        // Dekzandruggen, dekzandkopjes, stuwwallen\n  geomorf_middel: 0.6,      // Getij-oeverwallen, strandwallen, landduinen\n  geomorf_laag: 0.4,        // Dekzandwelvingen, stroomrugglooiingen\n\n  // Archaeological finds (where people DID live)\n  amk_zeer_hoog: 1.0,       // Proven very important site\n  amk_hoog: 0.8,\n  amk_basis: 0.6,\n  grafheuvel: 0.8,\n  hunebed: 0.8,\n  steentijd: 0.6,\n  uikav: 0.6,\n  kasteel: 0.4,\n  ruine: 0.4,\n}\n\n// Cache for loaded data\nlet cachedWeightedPoints: Feature<Point>[] | null = null\nlet isLoading = false\nlet loadPromise: Promise<Feature<Point>[]> | null = null\n\n/**\n * Load GeoJSON file and return features\n */\nasync function loadGeoJSONFeatures(url: string): Promise<Feature[]> {\n  try {\n    const response = await fetch(url)\n    if (!response.ok) {\n      console.warn(`Kansenkaart: Could not load ${url}`)\n      return []\n    }\n    const geojson = await response.json()\n    return new GeoJSON().readFeatures(geojson, {\n      dataProjection: 'EPSG:4326',\n      featureProjection: 'EPSG:3857'\n    })\n  } catch (error) {\n    console.warn(`Kansenkaart: Error loading ${url}:`, error)\n    return []\n  }\n}\n\n/**\n * Extract centroid point from any geometry type\n */\nfunction getCentroid(feature: Feature): [number, number] | null {\n  const geom = feature.getGeometry()\n  if (!geom) return null\n\n  if (geom.getType() === 'Point') {\n    return (geom as Point).getCoordinates() as [number, number]\n  }\n\n  // For polygons and other geometries, get the center of the extent\n  const extent = geom.getExtent()\n  return [\n    (extent[0] + extent[2]) / 2,\n    (extent[1] + extent[3]) / 2\n  ]\n}\n\n/**\n * Create a weighted point feature for the heatmap\n */\nfunction createWeightedPoint(coords: [number, number], weight: number): Feature<Point> {\n  const feature = new Feature({\n    geometry: new Point(coords),\n    weight: weight\n  })\n  return feature\n}\n\n/**\n * Load all data sources and create weighted point features\n */\nasync function loadAllWeightedPoints(): Promise<Feature<Point>[]> {\n  if (cachedWeightedPoints) return cachedWeightedPoints\n\n  // Prevent duplicate loading\n  if (isLoading && loadPromise) return loadPromise\n\n  isLoading = true\n\n  loadPromise = (async () => {\n    const weightedPoints: Feature<Point>[] = []\n\n    console.log('ðŸ—ºï¸ Kansenkaart: Loading archaeological data sources...')\n\n    // Load all data sources in parallel\n    const [\n      amkGeojson,\n      grafheuvelsFeatures,\n      hunebeddenFeatures,\n      steentijdFeatures,\n      uikavFeatures,\n      kastelenFeatures,\n      ruinesFeatures,\n      geomorfologieFeatures\n    ] = await Promise.all([\n      // AMK - TopoJSON\n      loadTopoJSON('/detectorapp-nl/data/amk_monumenten_full.topojson').catch(() => null),\n      // Grafheuvels\n      loadGeoJSONFeatures('/detectorapp-nl/data/grafheuvels.geojson'),\n      // Hunebedden\n      loadGeoJSONFeatures('/detectorapp-nl/data/steentijd/hunebedden.geojson'),\n      // EuroEVOL Steentijd sites\n      loadGeoJSONFeatures('/detectorapp-nl/data/steentijd/euroevol_nl_be.geojson'),\n      // UIKAV Punten\n      loadGeoJSONFeatures('/detectorapp-nl/data/uikav/uikav_archeo_punten.geojson'),\n      // Kastelen\n      loadGeoJSONFeatures('/detectorapp-nl/data/kastelen.geojson'),\n      // RuÃ¯nes\n      loadGeoJSONFeatures('/detectorapp-nl/data/ruines_osm.geojson'),\n      // Geomorfologie hotspots (stroomruggen, rivierduinen, dekzandruggen, etc.)\n      loadGeoJSONFeatures('/detectorapp-nl/data/geomorfologie_hotspots.geojson')\n    ])\n\n    // Process AMK monuments with quality-based weights\n    if (amkGeojson) {\n      const amkFeatures = parseGeoJSON(amkGeojson)\n      for (const feature of amkFeatures) {\n        const coords = getCentroid(feature)\n        if (!coords) continue\n\n        const quality = (feature.get('kwaliteitswaarde') || '').toLowerCase()\n        let weight = WEIGHTS.amk_basis\n\n        if (quality.includes('zeer hoge')) {\n          weight = WEIGHTS.amk_zeer_hoog\n        } else if (quality.includes('hoge')) {\n          weight = WEIGHTS.amk_hoog\n        }\n\n        weightedPoints.push(createWeightedPoint(coords, weight))\n      }\n      console.log(`  âœ“ AMK: ${amkFeatures.length} monumenten`)\n    }\n\n    // Process Grafheuvels\n    for (const feature of grafheuvelsFeatures) {\n      const coords = getCentroid(feature)\n      if (coords) {\n        weightedPoints.push(createWeightedPoint(coords, WEIGHTS.grafheuvel))\n      }\n    }\n    console.log(`  âœ“ Grafheuvels: ${grafheuvelsFeatures.length}`)\n\n    // Process Hunebedden\n    for (const feature of hunebeddenFeatures) {\n      const coords = getCentroid(feature)\n      if (coords) {\n        weightedPoints.push(createWeightedPoint(coords, WEIGHTS.hunebed))\n      }\n    }\n    console.log(`  âœ“ Hunebedden: ${hunebeddenFeatures.length}`)\n\n    // Process Steentijd sites\n    for (const feature of steentijdFeatures) {\n      const coords = getCentroid(feature)\n      if (coords) {\n        weightedPoints.push(createWeightedPoint(coords, WEIGHTS.steentijd))\n      }\n    }\n    console.log(`  âœ“ Steentijd sites: ${steentijdFeatures.length}`)\n\n    // Process UIKAV\n    for (const feature of uikavFeatures) {\n      const coords = getCentroid(feature)\n      if (coords) {\n        weightedPoints.push(createWeightedPoint(coords, WEIGHTS.uikav))\n      }\n    }\n    console.log(`  âœ“ UIKAV punten: ${uikavFeatures.length}`)\n\n    // Process Kastelen\n    for (const feature of kastelenFeatures) {\n      const coords = getCentroid(feature)\n      if (coords) {\n        weightedPoints.push(createWeightedPoint(coords, WEIGHTS.kasteel))\n      }\n    }\n    console.log(`  âœ“ Kastelen: ${kastelenFeatures.length}`)\n\n    // Process RuÃ¯nes\n    for (const feature of ruinesFeatures) {\n      const coords = getCentroid(feature)\n      if (coords) {\n        weightedPoints.push(createWeightedPoint(coords, WEIGHTS.ruine))\n      }\n    }\n    console.log(`  âœ“ RuÃ¯nes: ${ruinesFeatures.length}`)\n\n    // Process Geomorfologie hotspots (stroomruggen, rivierduinen, dekzandruggen, etc.)\n    // The weight is already stored in the GeoJSON from the extraction script\n    for (const feature of geomorfologieFeatures) {\n      const coords = getCentroid(feature)\n      if (coords) {\n        // Get the pre-calculated weight from the feature properties\n        const featureWeight = feature.get('weight') || 0.5\n        weightedPoints.push(createWeightedPoint(coords, featureWeight))\n      }\n    }\n    console.log(`  âœ“ Geomorfologie hotspots: ${geomorfologieFeatures.length}`)\n\n    console.log(`ðŸ—ºï¸ Kansenkaart: ${weightedPoints.length} total weighted points loaded`)\n\n    cachedWeightedPoints = weightedPoints\n    isLoading = false\n    return weightedPoints\n  })()\n\n  return loadPromise\n}\n\n/**\n * Create the Kansenkaart heatmap layer\n */\nexport async function createKansenkaartLayerOL() {\n  try {\n    console.log('ðŸ—ºï¸ Kansenkaart: Starting layer creation...')\n    const weightedPoints = await loadAllWeightedPoints()\n    console.log(`ðŸ—ºï¸ Kansenkaart: Got ${weightedPoints.length} weighted points`)\n\n    const source = new VectorSource({\n      features: weightedPoints\n    })\n\n    const heatmapLayer = new HeatmapLayer({\n      source: source,\n      properties: {\n        title: 'Kansenkaart',\n        type: 'heatmap',\n        queryable: false  // No popup for heatmap\n      },\n      visible: false,\n      opacity: 0.6,\n      zIndex: 5, // Below other layers but above base map\n      blur: 15,   // Reduced for better performance\n      radius: 8,  // Reduced for better performance with many points\n      weight: (feature) => {\n        // Get the weight we stored on the feature\n        return feature.get('weight') || 0.5\n      },\n      // Gradient: transparent -> blue -> cyan -> green -> yellow -> orange -> red\n      gradient: ['rgba(0,0,255,0)', 'rgba(0,0,255,0.5)', '#00ffff', '#00ff00', '#ffff00', '#ff8800', '#ff0000']\n    })\n\n    console.log('âœ“ Kansenkaart heatmap layer created')\n    return heatmapLayer\n\n  } catch (error) {\n    console.error('Failed to create Kansenkaart layer:', error)\n    return null\n  }\n}\n\n/**\n * Get statistics about loaded data\n */\nexport function getKansenkaartStats() {\n  return {\n    totalPoints: cachedWeightedPoints?.length || 0,\n    isLoaded: cachedWeightedPoints !== null\n  }\n}\n"],"names":["WEIGHTS","cachedWeightedPoints","isLoading","loadPromise","loadGeoJSONFeatures","url","response","geojson","GeoJSON","error","getCentroid","feature","geom","extent","createWeightedPoint","coords","weight","Feature","Point","loadAllWeightedPoints","weightedPoints","amkGeojson","grafheuvelsFeatures","hunebeddenFeatures","steentijdFeatures","uikavFeatures","kastelenFeatures","ruinesFeatures","geomorfologieFeatures","loadTopoJSON","amkFeatures","parseGeoJSON","quality","featureWeight","createKansenkaartLayerOL","source","VectorSource","heatmapLayer","HeatmapLayer"],"mappings":"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"}
{"version":3,"file":"DictionaryScriptEvaluator-B-tvTA5w.js","sources":["../../node_modules/@arcgis/core/renderers/support/DictionaryScriptEvaluator.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";import r from\"../../core/Logger.js\";import{Version as i}from\"../../core/Version.js\";import t from\"../../layers/support/FieldsIndex.js\";import{createDictionaryExpression as o,ArcadeFeatureReader as n}from\"../../support/ArcadeExpression.js\";class s{static async from(t,n,c){const l=t.dictionary_version?i.parse(t.dictionary_version):null,d=new Set(t.itemsNames),u={};if(n)for(const e in n)u[e]=n[e];if(t.authoringInfo.configuration)for(const e of t.authoringInfo.configuration)u.hasOwnProperty(e.name)||(u[e.name]=e.value);const p=new Set(t.authoringInfo.symbol);for(const e of Object.keys(c))p.delete(e);p.size&&r.getLogger(\"esri.renderers.support.DictionaryScriptEvaluator\").warnOnce(\"missing-fields: fieldMap entries for the following symbol fields are missing\",{symbolFields:p});const f=await o(t.expression,null,u);if(!f)throw new e(\"dictionary-renderer:expression-error\",\"Unable to create dictionary renderer expression\");const g=!l||!l.greaterEqual(4,0);g&&r.getLogger(\"esri.renderers.support.DictionaryScriptEvaluator\").warnOnce(\"Dictionary script does not support native field types. Applying fallback\",{version:l});const m=new a(c,g);return new s(g,d,f,m)}constructor(e,r,i,t){this._requiresFieldCoercionToString=e,this._itemNames=r,this._compiled=i,this._reader=t}get itemNames(){return this._itemNames}evaluate(e,i,t,o){try{return this._reader.bind(e,t,o),this._compiled.evaluate(this._reader,{$view:{scale:i}})}catch(n){r.getLogger(\"esri.renderers.support.DictionaryScriptEvaluator\").warnOnce(\"arcade: dictionary script evaluation failed\",{error:n})}return null}createDictionaryFieldsIndex(e){if(!this._requiresFieldCoercionToString)return new t(e);const r=e.map(e=>({...e,type:\"esriFieldTypeString\"}));return new t(r)}}class a extends n{constructor(e,r){super(),this._fieldMap=e,this._requiresFieldCoercionToString=r}_getField(e){const r=this._fieldMap[e]??e;return this._boundSchema.fieldsIndex.get(r)}field(e){if(!this._requiresFieldCoercionToString)return super.field(e,!1);const r=this._getField(e);if(null==r)return\"\";return null==this._boundTarget.attributes[r.name]?\"\":\"\"+this._boundTarget.attributes[r.name]}}export{s as DictionaryScriptEvaluator};\n"],"names":["s","t","n","c","l","i","d","u","e","p","r","f","o","g","m","a"],"mappings":"+JAIkR,MAAMA,CAAC,CAAC,aAAa,KAAKC,EAAEC,EAAEC,EAAE,CAAC,MAAMC,EAAEH,EAAE,mBAAmBI,EAAE,MAAMJ,EAAE,kBAAkB,EAAE,KAAKK,EAAE,IAAI,IAAIL,EAAE,UAAU,EAAEM,EAAE,CAAA,EAAG,GAAGL,EAAE,UAAUM,KAAKN,EAAEK,EAAEC,CAAC,EAAEN,EAAEM,CAAC,EAAE,GAAGP,EAAE,cAAc,cAAc,UAAUO,KAAKP,EAAE,cAAc,cAAcM,EAAE,eAAeC,EAAE,IAAI,IAAID,EAAEC,EAAE,IAAI,EAAEA,EAAE,OAAO,MAAMC,EAAE,IAAI,IAAIR,EAAE,cAAc,MAAM,EAAE,UAAUO,KAAK,OAAO,KAAKL,CAAC,EAAEM,EAAE,OAAOD,CAAC,EAAEC,EAAE,MAAMC,EAAE,UAAU,kDAAkD,EAAE,SAAS,+EAA+E,CAAC,aAAaD,CAAC,CAAC,EAAE,MAAME,EAAE,MAAMC,EAAEX,EAAE,WAAW,KAAKM,CAAC,EAAE,GAAG,CAACI,EAAE,MAAM,IAAIH,EAAE,uCAAuC,iDAAiD,EAAE,MAAMK,EAAE,CAACT,GAAG,CAACA,EAAE,aAAa,EAAE,CAAC,EAAES,GAAGH,EAAE,UAAU,kDAAkD,EAAE,SAAS,2EAA2E,CAAC,QAAQN,CAAC,CAAC,EAAE,MAAMU,EAAE,IAAIC,EAAEZ,EAAEU,CAAC,EAAE,OAAO,IAAIb,EAAEa,EAAEP,EAAEK,EAAEG,CAAC,CAAC,CAAC,YAAY,EAAE,EAAE,EAAEb,EAAE,CAAC,KAAK,+BAA+B,EAAE,KAAK,WAAW,EAAE,KAAK,UAAU,EAAE,KAAK,QAAQA,CAAC,CAAC,IAAI,WAAW,CAAC,OAAO,KAAK,UAAU,CAAC,SAAS,EAAEI,EAAEJ,EAAEW,EAAE,CAAC,GAAG,CAAC,OAAO,KAAK,QAAQ,KAAK,EAAEX,EAAEW,CAAC,EAAE,KAAK,UAAU,SAAS,KAAK,QAAQ,CAAC,MAAM,CAAC,MAAMP,CAAC,CAAC,CAAC,CAAC,OAAOH,EAAE,CAACQ,EAAE,UAAU,kDAAkD,EAAE,SAAS,8CAA8C,CAAC,MAAMR,CAAC,CAAC,CAAC,CAAC,OAAO,IAAI,CAAC,4BAA4B,EAAE,CAAC,GAAG,CAAC,KAAK,+BAA+B,OAAO,IAAID,EAAE,CAAC,EAAE,MAAM,EAAE,EAAE,IAAIO,IAAI,CAAC,GAAGA,EAAE,KAAK,qBAAqB,EAAE,EAAE,OAAO,IAAIP,EAAE,CAAC,CAAC,CAAC,CAAC,MAAMc,UAAUb,CAAC,CAAC,YAAY,EAAE,EAAE,CAAC,MAAK,EAAG,KAAK,UAAU,EAAE,KAAK,+BAA+B,CAAC,CAAC,UAAU,EAAE,CAAC,MAAM,EAAE,KAAK,UAAU,CAAC,GAAG,EAAE,OAAO,KAAK,aAAa,YAAY,IAAI,CAAC,CAAC,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,KAAK,+BAA+B,OAAO,MAAM,MAAM,EAAE,EAAE,EAAE,MAAM,EAAE,KAAK,UAAU,CAAC,EAAE,OAAS,GAAN,MAA8B,KAAK,aAAa,WAAW,EAAE,IAAI,GAAzC,KAAV,GAAwD,GAAG,KAAK,aAAa,WAAW,EAAE,IAAI,CAAC,CAAC","x_google_ignoreList":[0]}
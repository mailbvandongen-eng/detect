{"version":3,"file":"OperatorShapePreservingLength-BLcrra0B.js","sources":["../../node_modules/@arcgis/core/chunks/OperatorShapePreservingLength.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{a as e,G as t,f as s,d as n}from\"./Geometry.js\";import{a8 as o,G as r,r as a,x as i,a9 as m}from\"./UnitFactory.js\";import{a as c,P as g}from\"./MultiPathImpl.js\";import{k as u,d as p,P as h}from\"./Point2D.js\";import{d as y}from\"./Envelope.js\";import{Envelope2D as l}from\"./Envelope2D.js\";import{O as f}from\"./OperatorDensify.js\";import{O as x}from\"./OperatorClip.js\";function _(){return{m_pGcs:new h,m_xyz:new y,m_factor:Number.NaN,m_geoLength:Number.NaN,setValues:d,setLength:P,assign:S}}function d(e,t,s,n){this.m_factor=e,this.m_pGcs.assign(t),this.m_xyz.assign(n),this.m_geoLength=s}function P(e){this.m_geoLength=e}function S(e){this.m_pGcs.assign(e.m_pGcs),this.m_xyz.assign(e.m_xyz),this.m_factor=e.m_factor,this.m_geoLength=e.m_geoLength}class w{getOperatorType(){return 10315}supportsCurves(){return!0}accelerateGeometry(e,t,s){return!1}canAccelerateGeometry(e){return!1}_ExecuteShapePreservingLength(e,t,s,n,a){if(e.hasNonLinearSegments()){e=(new f).execute(e,0,t.getTolerance(0),0,a)}if(t.isPannable()){let n=90,r=-90;if(1===s.getUnit().getUnitToBaseFactor()&&(n*=Math.PI/180,r*=Math.PI/180),2===t.getCoordinateSystemType()){let e=null;const s=[0,0,0,0];e=t.getPECoordSys(),s[0]=0,s[1]=n,s[2]=0,s[3]=r,o.geogToProj(e,2,s),n=s[1],r=s[3]}const i=new l;e.queryEnvelope(i),i.ymin=r,i.ymax=n,e=(new x).execute(e,i,t,a)}else{const s=t.getPCSHorizon();if((e=(new r).execute(e,s,t,a))===s){const t=e.clone();e=t}}return e.isEmpty()?0:this._ExecuteIterativeApproach(e,t,s,n,1,a)}_ExecuteIterativeApproach(e,t,s,r,i,m){const c=a();s.querySpheroidData(c);const g=c.majorSemiAxis,l=c.e2,f=s.getUnit().getUnitToBaseFactor(),x=40,d=u(_,x),P=p(x,Number.NaN),S=_(),w=_();let E;const G=[0,0,0,0],L=t.getPECoordSys(),j=new h,v=new h,T=new h,D=new h,b=new h;let z=0;const I=e.querySegmentIterator();for(;I.nextPath();)for(;I.hasNextSegment();){const e=I.nextSegment();j.assign(e.getStartXY()),v.assign(e.getEndXY()),2===t.getCoordinateSystemType()?(G[0]=j.x,G[1]=j.y,G[2]=v.x,G[3]=v.y,o.projToGeog(L,2,G),T.x=G[0]*f,T.y=G[1]*f,D.x=G[2]*f,D.y=G[3]*f):(T.setCoordsPoint2D(j),D.setCoordsPoint2D(v),T.scale(f),D.scale(f));const s=new y,r=new y;N(g,l,T,s),N(g,l,D,r);let a=C(g,s,r);S.setValues(0,T,Number.NaN,s),w.setValues(1,D,a,r),E=i,d[0].assign(w),P[0]=i;let m=0;for(;;){m>128&&n(\"iterations exceeded\");const s=.5*(S.m_factor+w.m_factor),r=e.getCoord2D(s);2===t.getCoordinateSystemType()?(G[0]=r.x,G[1]=r.y,o.projToGeog(L,1,G),b.x=G[0]*f,b.y=G[1]*f):(b.setCoordsPoint2D(r),b.scale(f)),T.setCoordsPoint2D(S.m_pGcs),D.setCoordsPoint2D(w.m_pGcs);const c=new y;N(g,l,b,c);const u=C(g,S.m_xyz,c),p=C(g,w.m_xyz,c);a=w.m_geoLength,Number.isNaN(a)&&(a=C(g,S.m_xyz,w.m_xyz));const h=u+p,_=E===i&&h>=20&&Math.abs(h-a)>1e-8*(a+h);if(m+2<x&&(_||Math.abs(h-a)>0&&E>0))w.setLength(p),d[m].assign(w),w.setValues(s,b,u,c),d[++m].assign(w),_?(E=i,P[m]=i):(E--,P[m-1]=E,P[m]=E);else{if(z+=h,0===m)break;S.assign(w),w.assign(d[--m]),E=P[m]}}}return z}execute(n,o,r){if(o&&0!==o.getCoordinateSystemType()||e(\"\"),n.isEmpty()||n.getDimension()<1)return 0;let a=null;const m=o.getGCS();m!==o&&(a=i(o,m,null));const u=n.getGeometryType();if(u===t.enumEnvelope){const e=new c;return e.addEnvelope(n,!1),this._ExecuteShapePreservingLength(e,o,m,a,r)}if(s(u)){const e=new g;return e.addSegment(n,!0),this._ExecuteShapePreservingLength(e,o,m,a,r)}return this._ExecuteShapePreservingLength(n,o,m,a,r)}}function N(e,t,s,n){n.assign(m(e,t,s))}function C(e,t,s){const n=e,o=new y;o.setSub(t,s);const r=o.length();return 2*n*Math.asin(r/(2*n))}export{w as O};\n"],"names":["_","h","y","d","P","S","e","t","s","w","n","a","f","o","i","l","x","r","c","u","p","E","G","L","j","v","T","D","b","z","I","N","C","m","g"],"mappings":"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","x_google_ignoreList":[0]}
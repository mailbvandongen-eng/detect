{"version":3,"file":"BufferObject-Dk-Dah7e.js","sources":["../../node_modules/@arcgis/core/views/webgl/BufferObject.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{isArrayLike as t}from\"../../core/arrayUtils.js\";import has from\"../../core/has.js\";import e from\"../../core/Logger.js\";import{isUint8Array as s,isUint16Array as i,isUint32Array as r}from\"../../core/typedArrayUtil.js\";import{checkWebGLError as n}from\"./checkWebGLError.js\";import{ResourceType as u,DataType as a}from\"./enums.js\";const f=()=>e.getLogger(\"esri.views.webgl.BufferObject\"),h=null,c=!!has(\"esri-tests-disable-gpu-memory-measurements\");class o{static createIndex(t,e,s){return new o(t,34963,e,s)}static createUniform(t,e,s){return new o(t,35345,e,s)}static createPixelPack(t,e=35041,s){const i=new o(t,35051,e);return s&&i.setSize(s),i}static createPixelUnpack(t,e=35040,s){return new o(t,35052,e,s)}static createTransformFeedback(t,e=35044,s){const i=new o(t,35982,e);return i.setSize(s),i}constructor(t,e,s,i){this._context=t,this.bufferType=e,this.usage=s,this._glName=null,this._size=-1,this._indexType=void 0,t.instanceCounter.increment(u.BufferObject,this),this._glName=this._context.gl.createBuffer(),n(this._context.gl),i&&this.setData(i)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get sizeBytes(){if(34963===this.bufferType){if(this._indexType===a.UNSIGNED_INT)return 4*this._size;if(this._indexType===a.UNSIGNED_SHORT)return 2*this._size}return this._size}get usedMemory(){return c?0:this.sizeBytes}get _isVAOAware(){return 34963===this.bufferType||34962===this.bufferType}dispose(){if(this._context?.gl){if(this._glName){this._context.gl.deleteBuffer(this._glName),this._glName=null}this._context.instanceCounter.decrement(u.BufferObject,this),this._context=null}else this._glName&&f().warn(\"Leaked WebGL buffer object\")}setSize(t,e=null){if(34963===this.bufferType&&null!=e)switch(this._indexType=e,e){case a.UNSIGNED_SHORT:t*=2;break;case a.UNSIGNED_INT:t*=4}this._setBufferData(t)}setData(t){if(!t)return;let e=t.byteLength;34963===this.bufferType&&(s(t)?this._indexType=a.UNSIGNED_BYTE:i(t)?(e/=2,this._indexType=a.UNSIGNED_SHORT):r(t)&&(e/=4,this._indexType=a.UNSIGNED_INT)),this._setBufferData(e,t)}_setBufferData(t,e=null){this._size=t;const s=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const i=this._context.gl;null!=e?i.bufferData(this.bufferType,e,this.usage):i.bufferData(this.bufferType,t,this.usage),n(i),this._isVAOAware&&this._context.bindVAO(s)}setSubData(t,e,s,i){if(!t)return;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:u}=this._context;u.bufferSubData(this.bufferType,e*t.BYTES_PER_ELEMENT,t,s,i-s),n(u),this._isVAOAware&&this._context.bindVAO(r)}getSubData(t,e=0,s,i){if(s<0||i<0)return;const r=_(t)?t.BYTES_PER_ELEMENT:1;if(r*((s??0)+(i??0))>t.byteLength)return;e+r*(i??0)>this.usedMemory&&f().warn(\"Potential problem getting subdata: requested data exceeds buffer size!\");const n=this._context.gl;35982===this.bufferType?(this._context.bindBuffer(this,35982),n.getBufferSubData(35982,e,t,s,i),this._context.unbindBuffer(35982)):(this._context.bindBuffer(this,36662),n.getBufferSubData(36662,e,t,s,i),this._context.unbindBuffer(36662))}async getSubDataAsync(t,e=0,s,i){await this._context.clientWaitAsync(),this.getSubData(t,e,s,i)}}function _(e){return t(e)}export{o as BufferObject,h as tracer};\n"],"names":["f","e","c","has","o$1","o","t","u","n","a","s","i","r","_"],"mappings":"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","x_google_ignoreList":[0]}
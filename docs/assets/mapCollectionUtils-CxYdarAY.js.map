{"version":3,"file":"mapCollectionUtils-CxYdarAY.js","sources":["../../node_modules/@arcgis/core/core/mapCollectionUtils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{createTask as e}from\"./asyncUtils.js\";import t from\"./Collection.js\";import{removeIfHandle as o,destroyHandle as s}from\"./handleUtils.js\";import{isAborted as r,createAbortError as n,ignoreAbortErrors as i}from\"./promiseUtils.js\";import{on as a}from\"./reactiveUtils.js\";function c(e,o,s){const r=s?.createCollection?.()??new t,n=!!s?.recycleItems?new d:null,i=(e,t=0)=>{if(!e?.length)return;const o=r.splice(t,e.length);n?n.processRemoved(e):o.forEach(m)},c=(e,t=0)=>{if(!e?.length)return;const s=[];for(const r of e){const e=n?.use(r);if(e)s.push(e);else{const e=o(r);n?.register(r,e),s.push(e)}}r.addMany(s,t)},l=a(e,\"after-splice\",({added:e,start:t,removed:o})=>{i(o,t),c(e,t)},{sync:!0,onListenerRemove:e=>i(e.items),onListenerAdd:e=>c(e.items)});return r.addHandles(l),r}class d{constructor(){this._originalToMapped=new Map,this._removedItemCandidates=new Set,this._garbageCollectionQueued=!1}processRemoved(e){if(!e?.length)return;const{_removedItemCandidates:t}=this;for(const o of e)this._getItem(o)?.markRemoved()&&(t.add(o),this._queueGarbageCollection())}use(e){const t=this._getItem(e);return t&&(t.removed=!1),t?.item}register(e,t){this._originalToMapped.set(e,new l(t))}_getItem(e){return this._originalToMapped.get(e)}_queueGarbageCollection(){this._garbageCollectionQueued||(this._garbageCollectionQueued=!0,queueMicrotask(()=>this._garbageCollectCandidates()))}_garbageCollectCandidates(){this._garbageCollectionQueued=!1;const{_removedItemCandidates:e}=this,t=Array.from(e);e.clear(),t.forEach(e=>this._garbageCollectIfRemoved(e))}_garbageCollectIfRemoved(e){const{_originalToMapped:t}=this,o=this._getItem(e);o?.removed&&(m(o.item),t.delete(e))}}class l{constructor(e){this.item=e,this.removed=!1}markRemoved(){return this.removed=!0,!0}}function m(e){\"object\"==typeof e&&e&&(\"destroy\"in e&&\"function\"==typeof e.destroy?e.destroy():o(e))}function u(o,a,d){const l=new t,u=c(o,t=>e(async e=>{const o=await a(t,e);if(r(e))throw m(o),n();return o}),d),f=()=>null,g=async e=>{const t=await e.promise,o=u.indexOf(e);o<0||l.splice(o,1,t)};l.addMany(u.items.map(f));for(const e of u)i(g(e));const h=u.on(\"after-splice\",({added:e,start:t,deleteCount:o})=>{const s=l.splice(t,o);for(const r of s)m(r);if(e?.length){l.addMany(e.map(f),t);for(const t of e)i(g(t))}});return l.addHandles([s(u),h]),l}export{c as mapCollection,u as mapCollectionAsync};\n"],"names":["c","e","o","r","t","n","d","i","s","l","a","u","f","g","h"],"mappings":"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","x_google_ignoreList":[0]}
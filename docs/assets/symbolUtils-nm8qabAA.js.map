{"version":3,"mappings":"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","names":["g","has","o","R","F","e","t","l","a","r","c","s","I","j","i","n","f","y","h","__vitePreload","d","m","b","w","S","v","V","k","u","p"],"ignoreList":[0,1,2],"sources":["../../node_modules/@arcgis/core/symbols/support/svgUtils.js","../../node_modules/@arcgis/core/symbols/support/renderUtils.js","../../node_modules/@arcgis/core/symbols/support/symbolUtils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport t from\"../../Color.js\";import has from\"../../core/has.js\";import{assertIsSome as e}from\"../../core/maybe.js\";import{pt2px as i,toPt as r}from\"../../core/screenUtils.js\";import{create as n}from\"../../core/libs/gl-matrix-2/factories/mat2df32.js\";import{multiply as o,scale as s,identity as a,translate as l,rotate as h}from\"../../core/libs/gl-matrix-2/math/mat2d.js\";import{getDashArray as c}from\"./gfxUtils.js\";import{nextBloomId as f,nextPatternId as u,nextLinearGradientId as d}from\"./svgGlobalState.js\";import\"../../widgets/support/widgetUtils.js\";import{tsx as y}from\"../../widgets/support/jsxFactory.js\";import\"@arcgis/toolkit/dom\";const p=\"http://www.w3.org/2000/svg\",g=has(\"android\"),m=has(\"chrome\")||g&&g>=4?\"auto\":\"optimizeLegibility\",x={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},w=/([A-DF-Za-df-z])|([-+]?\\d*\\.?\\d+(?:[eE][-+]?\\d+)?)/g;let k={},b={};const j=Math.PI;function M(t,e){const i=t*(j/180);return Math.abs(e*Math.sin(i))+Math.abs(e*Math.cos(i))}function v(t){return t.map(t=>`${t.command} ${t.values.join(\" \")}`).join(\" \").trim()}function S(t,i,r,n,o){if(t){if(\"circle\"===t.type)return y(\"circle\",{cx:t.cx,cy:t.cy,fill:i,\"fill-rule\":\"evenodd\",r:t.r,stroke:r.color,\"stroke-dasharray\":r.dashArray,\"stroke-dashoffset\":r.dashOffset,\"stroke-linecap\":r.cap,\"stroke-linejoin\":r.join,\"stroke-miterlimit\":\"4\",\"stroke-width\":r.width});if(\"ellipse\"===t.type)return y(\"ellipse\",{cx:t.cx,cy:t.cy,fill:i,\"fill-rule\":\"evenodd\",rx:t.rx,ry:t.ry,stroke:r.color,\"stroke-dasharray\":r.dashArray,\"stroke-linecap\":r.cap,\"stroke-linejoin\":r.join,\"stroke-miterlimit\":\"4\",\"stroke-width\":r.width});if(\"rect\"===t.type)return y(\"rect\",{fill:i,\"fill-rule\":\"evenodd\",height:t.height,stroke:r.color,\"stroke-dasharray\":r.dashArray,\"stroke-linecap\":r.cap,\"stroke-linejoin\":r.join,\"stroke-miterlimit\":\"4\",\"stroke-width\":r.width,width:t.width,x:t.x,y:t.y});if(\"image\"===t.type)return y(\"image\",{alt:o||\"image\",height:t.height,href:t.src,preserveAspectRatio:\"none\",width:t.width,x:t.x,y:t.y});if(\"path\"===t.type){const e=\"string\"!=typeof t.path?v(t.path):t.path;return y(\"path\",{d:e,fill:i,\"fill-rule\":\"evenodd\",stroke:r.color,\"stroke-dasharray\":r.dashArray,\"stroke-linecap\":r.cap,\"stroke-linejoin\":r.join,\"stroke-miterlimit\":\"4\",\"stroke-width\":r.width})}if(\"text\"===t.type)return e(n),y(\"text\",{\"dominant-baseline\":n.dominantBaseline,fill:i,\"fill-rule\":\"evenodd\",\"font-family\":n.font.family,\"font-size\":n.font.size,\"font-style\":n.font.style,\"font-variant\":n.font.variant,\"font-weight\":n.font.weight,kerning:n.kerning,rotate:n.rotate,stroke:r.color,\"stroke-dasharray\":r.dashArray,\"stroke-linecap\":r.cap,\"stroke-linejoin\":r.join,\"stroke-miterlimit\":\"4\",\"stroke-width\":r.width,\"text-anchor\":n.align,\"text-decoration\":n.decoration,\"text-rendering\":m,x:t.x,y:t.y},t.text)}return null}function $(e){if(!e)return{fill:\"none\",pattern:null,linearGradient:null};if(!(\"type\"in e))return{fill:new t(e).toString(),pattern:null,linearGradient:null};if(\"pattern\"===e.type){const t=`patternId-${u()}`;return{fill:`url(#${t})`,pattern:{id:t,x:e.x,y:e.y,width:e.width,height:e.height,image:{x:0,y:0,width:e.width,height:e.height,href:e.src}},linearGradient:null}}const i=`linearGradientId-${d()}`;return{fill:`url(#${i})`,pattern:null,linearGradient:{id:i,x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,stops:e.colors.map(e=>({offset:e.offset,color:e.color&&new t(e.color).toString()}))}}}function A(e){const i={color:\"none\",width:1,cap:\"butt\",join:\"4\",dashArray:\"none\",dashOffset:\"0\"};return e&&(null!=e.width&&(i.width=e.width),e.cap&&(i.cap=e.cap),e.join&&(i.join=e.join.toString()),e.color&&(i.color=new t(e.color).toString()),e.dashArray&&(i.dashArray=e.dashArray),e.dashoffset&&(i.dashOffset=e.dashoffset),e.style&&!e.dashArray&&(i.dashArray=c(e).join(\",\")||\"none\")),i}function G(t,i){const r={align:null,decoration:null,kerning:null,rotate:null,font:{style:null,variant:null,weight:null,size:null,family:null}};if(t){const n=t.alignBaseline,o=\"baseline\"===n?\"auto\":\"top\"===n?\"text-top\":\"bottom\"===n?\"hanging\":n;r.align=t.align,r.dominantBaseline=o,r.decoration=t.decoration,r.kerning=t.kerning?\"auto\":\"0\",r.rotate=t.rotated?\"90\":\"0\",e(i),r.font.style=i.style||\"normal\",r.font.variant=i.variant||\"normal\",r.font.weight=i.weight||\"normal\",r.font.size=i.size&&i.size.toString()||\"10pt\",r.font.family=i.family||\"serif\"}return r}function N(t){const{pattern:e,linearGradient:i}=t;if(e)return y(\"pattern\",{height:e.height,id:e.id,patternUnits:\"userSpaceOnUse\",width:e.width,x:e.x,y:e.y},y(\"image\",{height:e.image.height,href:e.image.href,width:e.image.width,x:e.image.x,y:e.image.y}));if(i){const t=i.stops.map((t,e)=>y(\"stop\",{key:`${e}-stop`,offset:t.offset,\"stop-color\":t.color}));return y(\"linearGradient\",{gradientUnits:\"userSpaceOnUse\",id:i.id,x1:i.x1,x2:i.x2,y1:i.y1,y2:i.y2},t)}return null}function z(t,e){if(!t||0===t.length)return null;const i=[];for(const r of t){const{shape:t,fill:e,stroke:n,font:o}=r,s=$(e),a=A(n),l=\"text\"===t.type?G(t,o):null,h=S(t,s.fill,a,l);h&&i.push(h)}return y(\"mask\",{id:e,maskUnits:\"userSpaceOnUse\"},y(\"g\",null,i))}function B(t,e,i){return l(t,a(t),[e,i])}function I(t,e,i,r,n){return s(t,a(t),[e,i]),t[4]=t[4]*e-r*e+r,t[5]=t[5]*i-n*i+n,t}function U(t,e,i,r){const n=e%360*Math.PI/180;h(t,a(t),n);const o=Math.cos(n),s=Math.sin(n),l=t[4],c=t[5];return t[4]=l*o-c*s+r*s-i*o+i,t[5]=c*o+l*s-i*s-r*o+r,t}function F(t,e){k&&\"left\"in k?(null!=k.left&&k.left>t&&(k.left=t),(null==k.right||k.right<t)&&(k.right=t),(null==k.top||k.top>e)&&(k.top=e),(null==k.bottom||k.bottom<e)&&(k.bottom=e)):k={left:t,bottom:e,right:t,top:e}}function E(t){const e=t.args,i=e.length;let r;switch(t.action){case\"M\":case\"L\":case\"C\":case\"S\":case\"Q\":case\"T\":for(r=0;r<i;r+=2)F(e[r],e[r+1]);b.x=e[i-2],b.y=e[i-1];break;case\"H\":for(r=0;r<i;++r)F(e[r],b.y);b.x=e[i-1];break;case\"V\":for(r=0;r<i;++r)F(b.x,e[r]);b.y=e[i-1];break;case\"m\":{let t=0;\"x\"in b||(F(b.x=e[0],b.y=e[1]),t=2);for(r=t;r<i;r+=2)F(b.x+=e[r],b.y+=e[r+1]);break}case\"l\":case\"t\":for(r=0;r<i;r+=2)F(b.x+=e[r],b.y+=e[r+1]);break;case\"h\":for(r=0;r<i;++r)F(b.x+=e[r],b.y);break;case\"v\":for(r=0;r<i;++r)F(b.x,b.y+=e[r]);break;case\"c\":for(r=0;r<i;r+=6)F(b.x+e[r],b.y+e[r+1]),F(b.x+e[r+2],b.y+e[r+3]),F(b.x+=e[r+4],b.y+=e[r+5]);break;case\"s\":case\"q\":for(r=0;r<i;r+=4)F(b.x+e[r],b.y+e[r+1]),F(b.x+=e[r+2],b.y+=e[r+3]);break;case\"A\":for(r=0;r<i;r+=7)F(e[r+5],e[r+6]);b.x=e[i-2],b.y=e[i-1];break;case\"a\":for(r=0;r<i;r+=7)F(b.x+=e[r+5],b.y+=e[r+6])}}function O(t,e,i){const r=x[t.toLowerCase()];let n;\"number\"==typeof r&&(r?e.length>=r&&(n={action:t,args:e.slice(0,e.length-e.length%r)},i.push(n),E(n)):(n={action:t,args:[]},i.push(n),E(n)))}function T(t){const e=(\"string\"!=typeof t.path?v(t.path):t.path).match(w),i=[];if(k={},b={},!e)return null;let r=\"\",n=[];const o=e.length;for(let a=0;a<o;++a){const t=e[a],o=parseFloat(t);isNaN(o)?(r&&O(r,n,i),n=[],r=t):n.push(o)}O(r,n,i);const s={x:0,y:0,width:0,height:0};return k&&\"left\"in k&&(s.x=k.left,s.y=k.top,s.width=k.right-k.left,s.height=k.bottom-k.top),s}function L(t){const e={x:0,y:0,width:0,height:0};if(\"circle\"===t.type)e.x=t.cx-t.r,e.y=t.cy-t.r,e.width=2*t.r,e.height=2*t.r;else if(\"ellipse\"===t.type)e.x=t.cx-t.rx,e.y=t.cy-t.ry,e.width=2*t.rx,e.height=2*t.ry;else if(\"image\"===t.type||\"rect\"===t.type)e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height;else if(\"path\"===t.type){const i=T(t);e.x=i.x,e.y=i.y,e.width=i.width,e.height=i.height}return e}function R(t){const e={x:0,y:0,width:0,height:0};let i=null,r=Number.NEGATIVE_INFINITY,n=Number.NEGATIVE_INFINITY;for(const o of t)i?(i.x=Math.min(i.x,o.x),i.y=Math.min(i.y,o.y),r=Math.max(r,o.x+o.width),n=Math.max(n,o.y+o.height)):(i=e,i.x=o.x,i.y=o.y,r=o.x+o.width,n=o.y+o.height);return i&&(i.width=r-i.x,i.height=n-i.y),i}function C(t,e,i,r,s,a,l,h,c){let f=(l&&a?M(a,e):e)/2,u=(l&&a?M(a,i):i)/2;if(c){const t=c[0],e=c[1];f=(l&&a?M(a,t):t)/2,u=(l&&a?M(a,e):e)/2}const d=t.width+r,y=t.height+r,p=n(),g=n();let m=!1;if(s&&0!==d&&0!==y){const t=e!==i?e/i:d/y,r=e>i?e:i;let n=1,s=1;isNaN(r)||(t>1?(n=r/d,s=r/t/y):(s=r/y,n=r*t/d)),o(g,g,I(p,n,s,f,u)),m=!0}const x=t.x+(d-r)/2,w=t.y+(y-r)/2;if(o(g,g,B(p,f-x,u-w)),!m&&(d>e||y>i)){const t=d/e>y/i,r=(t?e:i)/(t?d:y);o(g,g,I(p,r,r,x,w))}return h&&o(g,g,B(p,h[0],h[1])),a&&o(g,g,U(p,a,x,w)),`matrix(${g[0]},${g[1]},${g[2]},${g[3]},${g[4]},${g[5]})`}function D(t){const e=t?.match(/bloom\\(\\s*([^\\s]+)\\s+([^\\s]+)\\s+([^\\s]+)\\s*\\)/i);if(!e)return null;const[,n,o,s]=e;return{strength:Number(n),radius:i(r(o)),threshold:Number(s)}}function V(t,e,i){const r=D(t);if(!r)return null;const{strength:n,radius:o}=r,s=n>0?o:0,a=(n+s)*e,l=4*n+1;return y(\"filter\",{filterUnits:\"userSpaceOnUse\",height:\"300%\",id:`bloom${i}`,width:\"300%\",x:\"-100%\",y:\"-100%\"},y(\"feMorphology\",{in:\"SourceGraphic\",operator:\"dilate\",radius:(n+.5*s)*(5**(e/100)*(.4+e/100)),result:\"dilate\"}),y(\"feGaussianBlur\",{in:\"dilate\",result:\"blur\",stdDeviation:a/25}),y(\"feGaussianBlur\",{in:\"blur\",result:\"intensityBlur\",stdDeviation:a/50}),y(\"feComponentTransfer\",{in:\"SourceGraphic\",result:\"intensityBrightness\"},y(\"feFuncR\",{slope:l,type:\"linear\"}),y(\"feFuncG\",{slope:l,type:\"linear\"}),y(\"feFuncB\",{slope:l,type:\"linear\"})),y(\"feMerge\",null,y(\"feMergeNode\",{in:\"intensityBlur\"}),y(\"feMergeNode\",{in:\"intensityBrightness\"}),y(\"feGaussianBlur\",{stdDeviation:n/10})))}function q(t,i,r,n={}){const o=[],s=[],a=f(),l=V(n.cssEffectFilter,i,a);let h=null;if(l){const t=D(n.cssEffectFilter),e=n.clipBloomEffect||!t?.strength?0:(t.strength+t.radius/2)/3,o=i+i*e,s=r+r*e;h=[Math.max(o,10),Math.max(s,10)]}let c=i,u=r;if(n.useRotationSize)for(let e=0;e<t.length;e++){const t=n.rotations?.[e]??0;c=Math.max(M(t,i),c),u=Math.max(M(t,r),u)}for(let e=0;e<t.length;e++){const a=t[e],l=[],f=[];let d=0,p=0,g=0;for(const t of a){const{shape:e,fill:i,stroke:r,font:s,offset:a}=t;n.ignoreStrokeWidth||\"text\"===e.type||(d+=r?.width||0);const h=$(i),c=A(r),u=\"text\"===e.type?G(e,s):null;o.push(N(h)),l.push(S(e,h.fill,c,u,n.ariaLabel)),f.push(L(e)),a&&(p+=a[0],g+=a[1])}const m=n.rotations?.[e]??0;n.useRotationSize&&(p+=(c-M(m,i))/2,g+=(u-M(m,r))/2);const x=C(R(f),i,r,d,n.scale??!1,m,n.useRotationSize??!1,[p,g],h);let w=null;if(n.masking){const t=`mask-${e}`,i=n.masking[e];o.push(z(i,t)),w=`url(#${t})`}s.push(w?y(\"g\",{mask:w},y(\"g\",{transform:x},l)):y(\"g\",{transform:x},l))}l&&(e(h),c=h[0],u=h[1]);const d=\"display: block;\";return y(\"svg\",{\"aria-label\":n.ariaLabel,focusable:!1,height:u,role:\"img\",style:d,width:c,xmlns:p},l,y(\"defs\",null,o),l?y(\"g\",{filter:`url(#bloom${a})`},s):s)}export{R as computeBBox,$ as generateFillAttributes,A as generateStrokeAttributes,G as generateTextAttributes,L as getBoundingBox,C as getTransformMatrix,N as renderDef,q as renderSVG,S as renderShape};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{id as t}from\"../../kernel.js\";import e from\"../../request.js\";import{toHSV as i,toRGB as r}from\"../../core/colorUtils.js\";import n from\"../../core/Error.js\";import has from\"../../core/has.js\";import\"../../libs/maquette/projection.js\";import{createProjector as o}from\"../../libs/maquette/projector.js\";import{renderSVG as a}from\"./svgUtils.js\";const c=o();function s(t,e){c.append(t,e),c.detach(e)}function l(t,e,i){const r=Math.ceil(e[0]),n=Math.ceil(e[1]);if(!t.some(t=>!!t.length))return null;const o=i?.node||document.createElement(\"div\");null!=i.opacity&&(o.style.opacity=i.opacity.toString()),null!=i.cssEffectFilter&&(o.style.filter=i.cssEffectFilter);return s(o,()=>a(t,r,n,i)),o}function h(t,e){t=Math.ceil(t),e=Math.ceil(e);const i=document.createElement(\"canvas\");i.width=t,i.height=e,i.style.width=t+\"px\",i.style.height=e+\"px\";const r=i.getContext(\"2d\");return r.clearRect(0,0,t,e),r}function m(t,i,r){return t?e(t,{responseType:\"image\"}).then(t=>{const e=t.data,n=e.width,o=e.height,a=n/o;let c=i;if(r){const t=Math.max(n,o);c=Math.min(c,t)}return{image:e,width:a<=1?Math.ceil(c*a):c,height:a<=1?c:Math.ceil(c/a)}}):Promise.reject(new n(\"renderUtils: imageDataSize\",\"href not provided.\"))}function g(t,e){return!(!t||\"ignore\"===e)&&(\"multiply\"!==e||255!==t.r||255!==t.g||255!==t.b||1!==t.a)}function u(t,e,n,o,a){switch(a){case\"multiply\":t[e]*=n[0],t[e+1]*=n[1],t[e+2]*=n[2],t[e+3]*=n[3];break;default:{const a=i({r:t[e],g:t[e+1],b:t[e+2]});a.h=o.h,a.s=o.s,a.v=a.v/100*o.v;const c=r(a);t[e]=c.r,t[e+1]=c.g,t[e+2]=c.b,t[e+3]*=n[3];break}}}function d(e,r,n,o,a){return m(e,r,a).then(a=>{const c=a.width??r,s=a.height??r;if(a.image&&g(n,o)){let t=a.image.width,r=a.image.height;has(\"edge\")&&/\\.svg$/i.test(e)&&(t-=1,r-=1);const l=h(c,s);l.drawImage(a.image,0,0,t,r,0,0,c,s);const m=l.getImageData(0,0,c,s),g=[n.r/255,n.g/255,n.b/255,n.a],d=i(n);for(let e=0;e<m.data.length;e+=4)u(m.data,e,g,d,o);l.putImageData(m,0,0),e=l.canvas.toDataURL(\"image/png\")}else{const i=t?.findCredential(e);if(i?.token){const t=e.includes(\"?\")?\"&\":\"?\";e=`${e}${t}token=${i.token}`}}return{url:e,width:c,height:s}}).catch(()=>({url:e,width:r,height:r}))}export{s as renderOnce,l as renderSymbol,d as tintImageWithColor};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport\"../../core/has.js\";import{pt2px as e,toPt as t,px2pt as l}from\"../../core/screenUtils.js\";import{isSubtypeGroupLayer as a}from\"../../layers/support/layerUtils.js\";import{loadArcade as i}from\"../../support/loadArcade.js\";import{getStroke as r}from\"./gfxUtils.js\";import{renderSymbol as s,renderOnce as o}from\"./renderUtils.js\";import{isSymbol3D as n}from\"./typeUtils.js\";import{applyColorToSymbol as c,applySizesToSymbol as u,applyRotationToSymbol as p,getColorFromSymbol as f,applyOpacityToColor as y}from\"./utils.js\";import{renderRelationshipRamp as h}from\"../../widgets/Legend/styles/support/relationshipUtils.js\";import{getRelationshipRampElement as d}from\"../../widgets/Legend/support/relationshipRampUtils.js\";let m=null;const b=[255,255,255];function g(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function w(e,t,l){const{backgroundColor:a,outline:i,dotSize:r}=e,s=l?.swatchSize||22,o=.8,n=Math.round(s*s/Math.max(r,.5)**2*o),c=window.devicePixelRatio,u=document.createElement(\"canvas\"),p=s*c;u.width=p,u.height=p,u.style.width=u.width/c+\"px\",u.style.height=u.height/c+\"px\";const f=u.getContext(\"2d\");if(a&&(f.fillStyle=a.toCss(!0),f.fillRect(0,0,p,p),f.fill()),f.fillStyle=t?.toCss(!0)??\"\",m&&m.length/2===n)for(let h=0;h<2*n;h+=2){const e=m[h],t=m[h+1];f.fillRect(e,t,r*c,r*c),f.fill()}else{m=[];for(let e=0;e<2*n;e+=2){const e=g(0,p),t=g(0,p);m.push(e,t),f.fillRect(e,t,r*c,r*c),f.fill()}}i&&(i.color&&(f.strokeStyle=i.color.toCss(!0)),f.lineWidth=i.width,f.strokeRect(0,0,p,p));const y=new Image(s,s);return y.src=u.toDataURL(),y.ariaLabel=l?.ariaLabel??null,y.alt=l?.ariaLabel??\"\",y}function S(e,t={}){const l=t.radius||40,a=2*Math.PI*l,i=e.length,o=a/i,n=[],c=r(t.outline);null!=c?.width&&(c.width*=2),(c||t.backgroundColor)&&n.push({shape:{type:\"circle\",cx:l,cy:l,r:l},fill:t.backgroundColor,stroke:c,offset:[0,0]});const u=t.values,p=u&&u.length===i&&100===u.reduce((e,t)=>e+t,0),f=[0];for(let r=0;r<i;r++){let t=null;p&&(t=u[r]*a/100,f.push(t+f[r])),n.push({shape:{type:\"circle\",cx:l,cy:l,r:l/2},fill:[0,0,0,0],stroke:{width:l,dashArray:`${(t??o)/2} ${a}`,dashoffset:\"-\"+(p?f[r]/2:r*(o/2)),color:e[r]},offset:[0,0]})}let y=null;const h=2*l+(c?.width||0),d=t.holePercentage;if(d){c&&n.push({shape:{type:\"circle\",cx:l,cy:l,r:l*d},fill:null,stroke:c,offset:[0,0]});const e=h/2;y=[[{shape:{type:\"circle\",cx:e,cy:e,r:e},fill:b,stroke:c?{...c,color:b}:null,offset:[0,0]},{shape:{type:\"circle\",cx:e,cy:e,r:l*d},fill:[0,0,0],stroke:null,offset:[0,0]}]]}return s([n],[h,h],{cssEffectFilter:t.cssEffectFilter,ignoreStrokeWidth:!0,masking:y,rotations:[-90],ariaLabel:t.ariaLabel})}function v(e,t={}){const l=e?.authoringInfo;if(!(\"relationship\"===l?.type)||!l?.numClasses||!e.uniqueValueInfos)return null;const{focus:a,numClasses:i}=l,r=d({focus:a,numClasses:i,infos:e.uniqueValueInfos}),s=t?.node||document.createElement(\"div\");return o(s,()=>h(r,t.id||\"relationship\",{opacity:t.opacity||1,cssEffectFilter:t.cssEffectFilter,ariaLabel:t.ariaLabel})),s}function V(e,t={}){const l=24,a=75,i=\"horizontal\"===t.align,r=i?a:l,s=i?l:a,o=t.width??r,n=t.height??s,c=t.gradient??!0,u=window.devicePixelRatio,p=o*u,f=n*u,y=document.createElement(\"canvas\");y.width=p,y.height=f,y.ariaLabel=t.ariaLabel??null,y.style.width=`${o}px`,y.style.height=`${n}px`;const h=y.getContext(\"2d\"),d=i?p:0,m=i?0:f;if(c){const t=h.createLinearGradient(0,0,d,m),l=e.length,a=1===l?0:1/(l-1);e.forEach((e,l)=>t.addColorStop(l*a,e.toString())),h.fillStyle=t,h.fillRect(0,0,p,f)}else{const t=i?p/e.length:p,l=i?f:f/e.length;let a=0,r=0;for(const s of e)h.fillStyle=s.toString(),h.fillRect(a,r,t,l),a=i?a+t:0,r=i?0:r+l}const b=document.createElement(\"div\");return b.style.width=`${o}px`,b.style.height=`${n}px`,x(b,t?.cssEffectFilter),b.appendChild(y),b}function k(e){const t=e.match(/drop-shadow\\(\\s*([^\\s]+)\\s+[^\\s]+\\s+[^\\s]+\\s+.+?\\)/);return t?t[1]:null}function x(l,a){if(!a)return;l.style.filter=a;const i=k(a);if(i){const a=e(t(i));a<0?l.style.marginLeft=`${Math.abs(a)}px`:l.style.marginRight=`${a}px`}}async function L(e,t){switch(e.type){case\"web-style\":{const{previewWebStyleSymbol:l}=await import(\"./previewWebStyleSymbol.js\");return l(e,L,t)}case\"label-3d\":case\"line-3d\":case\"mesh-3d\":case\"point-3d\":case\"polygon-3d\":{const{previewSymbol3D:l}=await import(\"./previewSymbol3D.js\");return l(e,t)}case\"simple-marker\":case\"simple-line\":case\"simple-fill\":case\"picture-marker\":case\"picture-fill\":case\"text\":{const{previewSymbol2D:l}=await import(\"./previewSymbol2D.js\");return l(e,t)}case\"cim\":{const{previewCIMSymbol:l}=await import(\"./previewCIMSymbol.js\");return l(e,t)}default:return}}function R(e){return e&&void 0!==e.opacity?e.opacity*(\"parent\"in e?R(e.parent):1):1}async function F(e,t){if(!e)return;const l=e.sourceLayer,a=(null!=t&&t.useSourceLayer?l:e.layer)??l,r=t?.ignoreOpacity?1:R(a);if(null!=e.symbol&&(null==t||!0!==t.ignoreGraphicSymbol)){const l=\"web-style\"===e.symbol.type?await e.symbol.fetchSymbol({...t,acceptedFormats:t?.webStyleAcceptedFormats,cache:t?.webStyleCache}):e.symbol.clone();return c(l,null,{add:r}),l}const s=t?.renderer??I(a);let o=s&&\"getSymbolAsync\"in s?await s.getSymbolAsync(e,t):null;if(!o)return;if(o=\"web-style\"===o.type?await o.fetchSymbol({...t,acceptedFormats:t?.webStyleAcceptedFormats,cache:t?.webStyleCache}):o.clone(),!(s&&\"visualVariables\"in s&&s.visualVariables?.length&&j(o)))return c(o,null,{add:r}),o;if(\"arcadeRequiredForVisualVariables\"in s&&s.arcadeRequiredForVisualVariables&&null==t?.arcade){const e={...t};e.arcade=await i(),t=e}const{getColor:n,getOpacity:f,getAllSizes:y,getRotationAngle:h}=await import(\"../../renderers/visualVariables/support/visualVariableUtils.js\"),d=[],m=[],b=[],g=[];for(const i of s.visualVariables)switch(i.type){case\"color\":d.push(i);break;case\"opacity\":m.push(i);break;case\"rotation\":g.push(i);break;case\"size\":i.target||b.push(i)}const w=!!d.length&&d[d.length-1],S=w?n(w,e,t):null,v=!!t?.ignoreOpacity,V=!!m.length&&m[m.length-1],k=V?f(V,e,t):null;if(c(o,S,v?void 0:{override:k,add:r}),b.length&&!0!==t?.ignoreSizeVariables){const l=y(b,e,t);await u(o,l)}if(!0!==t?.ignoreRotationVariables)for(const i of g)p(o,h(i,e,t),i.axis);return o}async function C(e,t){if(!e)return;const{layer:l,sourceLayer:a}=e,r=R(l??a);if(null!=e.symbol&&(null==t||!0!==t.ignoreGraphicSymbol)){const l=\"web-style\"===e.symbol.type?await e.symbol.fetchSymbol({...t,acceptedFormats:t?.webStyleAcceptedFormats}):e.symbol.clone();return f(l,r)}const s=t?.renderer??I(l)??I(a);let o=s&&\"getSymbolAsync\"in s?await s.getSymbolAsync(e,t):void 0;if(!o)return;o=\"web-style\"===o.type?await o.fetchSymbol({...t,acceptedFormats:t?.webStyleAcceptedFormats}):o.clone();const n=f(o,void 0);if(!s||!(\"visualVariables\"in s)||\"visualVariables\"in s&&!s.visualVariables||\"visualVariables\"in s&&!s.visualVariables?.length||!j(o))return n?y(n,r):void 0;if(\"arcadeRequiredForVisualVariables\"in s&&s.arcadeRequiredForVisualVariables&&null==t?.arcade){const e={...t};e.arcade=await i(),t=e}const{getColor:c,getOpacity:u}=await import(\"../../renderers/visualVariables/support/visualVariableUtils.js\"),p=[],h=[];if(s.visualVariables)for(const i of s.visualVariables)switch(i.type){case\"color\":p.push(i);break;case\"opacity\":h.push(i)}const d=p.length>0?p[p.length-1]:null,m=(d?c(d,e,t):void 0)??n,b=h.length>0?h[h.length-1]:null,g=b?u(b,e,t):null;return null!=m&&null!=g&&(m.a=g),m?y(m,r):null}function j(e){return!n(e)||\"water\"!==e.symbolLayers.at(0)?.type}function I(e){if(e)return\"renderer\"in e?e.renderer:void 0}async function U(e,t,l){if(!e)return;const{layer:a,sourceLayer:i}=e,r=l?.renderer??I(a)??I(i);if(!r)return null;if(\"visualVariables\"in r&&r.visualVariables?.length){const{getRampStops:i}=await import(\"../../widgets/Legend/support/colorRampUtils.js\"),{getRampStops:s}=await import(\"../../widgets/Legend/support/sizeRampUtils.js\"),{getFormatOptionsForVisualVariable:o}=await import(\"../../widgets/Legend/support/utils.js\");let n=null;for(const c of r.visualVariables){const u=t?o(a,c,t.timeZone):null;let p=null;switch(c.type){case\"color\":p=await i(c,null,u);break;case\"opacity\":p=await i(c);break;case\"size\":c.target||(p=await s(r,c,null,l?.scale||t?.scale,t,u))}if(p?.length){const t=p.find((t,l)=>{const a=e.attributes[c.field];return 0===l?a>=t.value:l===p?.length-1?a<=t.value:t.value===a});if(t){n=t.label;break}}}if(n)return n}switch(r.type){case\"class-breaks\":{const t=\"getClassBreakInfo\"in r?await r.getClassBreakInfo(e,l):null;return t?.label??(t&&r.classBreakInfos?.length>1)?`${t.minValue} - ${t.maxValue}`:null}case\"unique-value\":{const t=\"getUniqueValueInfo\"in r?await r.getUniqueValueInfo(e,l):null;return t?.label}}return null}async function z(e,t){e?.layer&&a(e.layer)&&((e=e.cloneShallow()).layer=e.layer.findSublayerForFeature(e)??null);const i=null===e?t?.fallbackSymbol??null:await F(e,{ignoreGraphicSymbol:!!e.layer,ignoreOpacity:t?.ignoreOpacity??!0,ignoreRotationVariables:t?.ignoreRotationVariables??!0,ignoreSizeVariables:t?.ignoreSizeVariables??!0})??t?.fallbackSymbol??null;if(!i)return null;const r=await L(i,{geometry:t.useGeometryForShape?e?.geometry??null:null,useMarkerSymbolSize:!1!==t.useMarkerSymbolSize,size:{width:l(t.widthInPixels??16),height:l(t.heightInPixels??16)},...\"cim\"===i?.type?{cimOptions:{feature:{attributes:e?.attributes??{}}}}:{}});if(!r)return null;return\"element\"===(t?.format??\"element\")?r:r.outerHTML}export{C as getDisplayedColor,F as getDisplayedSymbol,U as getLegendLabel,z as previewGraphic,V as renderColorRampPreviewHTML,w as renderDotDensityPreviewHTML,S as renderPieChartPreviewHTML,L as renderPreviewHTML,v as renderRelationshipRampPreviewHTML};\n"],"file":"symbolUtils-nm8qabAA.js"}
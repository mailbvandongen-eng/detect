{"version":3,"file":"label-4Fcr-nYI.js","sources":["../../node_modules/@esri/calcite-components/dist/chunks/label.js"],"sourcesContent":["/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.\nv3.3.3 */\nimport { q as queryElementRoots, l as closestElementCrossShadowBoundary, m as isBefore } from \"./dom.js\";\nconst labelClickEvent = \"calciteInternalLabelClick\";\nconst labelConnectedEvent = \"calciteInternalLabelConnected\";\nconst labelDisconnectedEvent = \"calciteInternalLabelDisconnected\";\nconst labelTagName = \"calcite-label\";\nconst labelToLabelables = /* @__PURE__ */ new WeakMap();\nconst onLabelClickMap = /* @__PURE__ */ new WeakMap();\nconst onLabelConnectedMap = /* @__PURE__ */ new WeakMap();\nconst onLabelDisconnectedMap = /* @__PURE__ */ new WeakMap();\nconst unlabeledComponents = /* @__PURE__ */ new Set();\nconst findLabelForComponent = (componentEl) => {\n  const { id } = componentEl;\n  const forLabel = id && queryElementRoots(componentEl, { selector: `${labelTagName}[for=\"${id}\"]` });\n  if (forLabel) {\n    return forLabel;\n  }\n  const parentLabel = closestElementCrossShadowBoundary(componentEl, labelTagName);\n  if (!parentLabel || // labelable components within other custom elements are not considered labelable\n  hasAncestorCustomElements(parentLabel, componentEl)) {\n    return null;\n  }\n  return parentLabel;\n};\nfunction hasAncestorCustomElements(label, componentEl) {\n  let traversedElements;\n  const customElementAncestorCheckEventType = \"custom-element-ancestor-check\";\n  const listener = (event) => {\n    event.stopImmediatePropagation();\n    const composedPath = event.composedPath();\n    traversedElements = composedPath.slice(composedPath.indexOf(componentEl), composedPath.indexOf(label));\n  };\n  label.addEventListener(customElementAncestorCheckEventType, listener, { once: true });\n  componentEl.dispatchEvent(new CustomEvent(customElementAncestorCheckEventType, { composed: true, bubbles: true }));\n  label.removeEventListener(customElementAncestorCheckEventType, listener);\n  const ancestorCustomElements = traversedElements.filter((el) => el !== componentEl && el !== label).filter((el) => el.tagName?.includes(\"-\"));\n  return ancestorCustomElements.length > 0;\n}\nfunction connectLabel(component) {\n  if (!component) {\n    return;\n  }\n  const labelEl = findLabelForComponent(component.el);\n  if (onLabelClickMap.has(labelEl) && labelEl === component.labelEl || !labelEl && unlabeledComponents.has(component)) {\n    return;\n  }\n  const boundOnLabelDisconnected = onLabelDisconnected.bind(component);\n  if (labelEl) {\n    component.labelEl = labelEl;\n    const labelables = labelToLabelables.get(labelEl) || [];\n    labelables.push(component);\n    labelToLabelables.set(labelEl, labelables.sort(sortByDOMOrder));\n    if (!onLabelClickMap.has(component.labelEl)) {\n      onLabelClickMap.set(component.labelEl, onLabelClick);\n      component.labelEl.addEventListener(labelClickEvent, onLabelClick);\n    }\n    unlabeledComponents.delete(component);\n    document.removeEventListener(labelConnectedEvent, onLabelConnectedMap.get(component));\n    onLabelDisconnectedMap.set(component, boundOnLabelDisconnected);\n    document.addEventListener(labelDisconnectedEvent, boundOnLabelDisconnected);\n  } else if (!unlabeledComponents.has(component)) {\n    boundOnLabelDisconnected();\n    document.removeEventListener(labelDisconnectedEvent, onLabelDisconnectedMap.get(component));\n  }\n}\nfunction disconnectLabel(component) {\n  if (!component) {\n    return;\n  }\n  unlabeledComponents.delete(component);\n  document.removeEventListener(labelConnectedEvent, onLabelConnectedMap.get(component));\n  document.removeEventListener(labelDisconnectedEvent, onLabelDisconnectedMap.get(component));\n  onLabelConnectedMap.delete(component);\n  onLabelDisconnectedMap.delete(component);\n  if (!component.labelEl) {\n    return;\n  }\n  const labelables = labelToLabelables.get(component.labelEl);\n  if (labelables.length === 1) {\n    component.labelEl.removeEventListener(labelClickEvent, onLabelClickMap.get(component.labelEl));\n    onLabelClickMap.delete(component.labelEl);\n  }\n  labelToLabelables.set(\n    component.labelEl,\n    labelables.filter((labelable) => labelable !== component).sort(sortByDOMOrder)\n  );\n  component.labelEl = null;\n}\nfunction sortByDOMOrder(a, b) {\n  return isBefore(a.el, b.el) ? -1 : 1;\n}\nfunction getLabelText(component) {\n  return component.label || component.labelEl?.textContent?.trim() || \"\";\n}\nfunction onLabelClick(event) {\n  const labelClickTarget = event.detail.sourceEvent.target;\n  const labelables = labelToLabelables.get(this);\n  const clickedLabelable = labelables.find((labelable) => labelable.el === labelClickTarget);\n  const labelableChildClicked = labelables.includes(clickedLabelable);\n  if (labelableChildClicked) {\n    return;\n  }\n  const firstLabelable = labelables[0];\n  if (firstLabelable.disabled) {\n    return;\n  }\n  firstLabelable.onLabelClick(event);\n}\nfunction onLabelConnected() {\n  if (unlabeledComponents.has(this)) {\n    connectLabel(this);\n  }\n}\nfunction onLabelDisconnected() {\n  unlabeledComponents.add(this);\n  const boundOnLabelConnected = onLabelConnectedMap.get(this) || onLabelConnected.bind(this);\n  onLabelConnectedMap.set(this, boundOnLabelConnected);\n  document.addEventListener(labelConnectedEvent, boundOnLabelConnected);\n}\nasync function associateExplicitLabelToUnlabeledComponent(label) {\n  await label.componentOnReady();\n  const alreadyLabeled = labelToLabelables.has(label);\n  if (alreadyLabeled) {\n    return;\n  }\n  const forComponentEl = label.ownerDocument?.getElementById(label.for);\n  if (!forComponentEl) {\n    return;\n  }\n  requestAnimationFrame(() => {\n    for (const labelable of unlabeledComponents) {\n      if (labelable.el === forComponentEl) {\n        connectLabel(labelable);\n        break;\n      }\n    }\n  });\n}\nexport {\n  associateExplicitLabelToUnlabeledComponent as a,\n  labelDisconnectedEvent as b,\n  connectLabel as c,\n  disconnectLabel as d,\n  getLabelText as g,\n  labelConnectedEvent as l\n};\n"],"names":["labelClickEvent","labelConnectedEvent","labelDisconnectedEvent","labelTagName","labelToLabelables","onLabelClickMap","onLabelConnectedMap","onLabelDisconnectedMap","unlabeledComponents","findLabelForComponent","componentEl","id","forLabel","queryElementRoots","parentLabel","closestElementCrossShadowBoundary","hasAncestorCustomElements","label","traversedElements","customElementAncestorCheckEventType","listener","event","composedPath","el","connectLabel","component","labelEl","boundOnLabelDisconnected","onLabelDisconnected","labelables","sortByDOMOrder","onLabelClick","disconnectLabel","labelable","a","b","isBefore","getLabelText","labelClickTarget","clickedLabelable","firstLabelable","onLabelConnected","boundOnLabelConnected","associateExplicitLabelToUnlabeledComponent","forComponentEl"],"mappings":"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","x_google_ignoreList":[0]}
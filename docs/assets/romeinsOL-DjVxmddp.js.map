{"version":3,"file":"romeinsOL-DjVxmddp.js","sources":["../../src/layers/romeinsOL.ts"],"sourcesContent":["/**\r\n * Romeinse wegen Layers for OpenLayers\r\n * Itiner-E Roman road network dataset\r\n * Two versions:\r\n * - Romeinse wegen: filtered to Benelux + Rheinland (default for Detectie preset)\r\n * - Romeinse wegen (Wereld): complete world dataset\r\n */\r\n\r\nimport { Vector as VectorLayer } from 'ol/layer'\r\nimport { Vector as VectorSource } from 'ol/source'\r\nimport { Style, Stroke } from 'ol/style'\r\nimport GeoJSON from 'ol/format/GeoJSON'\r\nimport { loadGeoJSON } from '../utils/layerLoaderOL.js'\r\n\r\n// Bounding box for Benelux + relevant Germany (Rheinland-Westfalen to Saarland/Frankfurt)\r\n// West: Belgium west, East: past Frankfurt, South: Saarland, North: North Netherlands\r\nconst BENELUX_BOUNDS = {\r\n  minLon: 2.5,\r\n  maxLon: 10.5,\r\n  minLat: 49.0,\r\n  maxLat: 54.0\r\n}\r\n\r\n// Cache styles per resolution to avoid recreating\r\nconst styleCache = new Map<string, Style>()\r\n\r\nfunction getLineWidth(resolution: number): number {\r\n  // Thinner when zoomed out, thicker when zoomed in\r\n  if (resolution > 300) return 0.5    // Very zoomed out\r\n  if (resolution > 150) return 0.75   // Zoomed out\r\n  if (resolution > 75) return 1       // Medium-far\r\n  if (resolution > 40) return 1.5     // Medium\r\n  if (resolution > 20) return 2       // Medium-close\r\n  if (resolution > 10) return 2.5     // Close\r\n  return 3                            // Very close\r\n}\r\n\r\nfunction createStyle(resolution: number): Style {\r\n  const width = getLineWidth(resolution)\r\n  const cacheKey = `roman-${width}`\r\n\r\n  let style = styleCache.get(cacheKey)\r\n  if (!style) {\r\n    style = new Style({\r\n      stroke: new Stroke({\r\n        color: '#dc2626',\r\n        width: width\r\n      })\r\n    })\r\n    styleCache.set(cacheKey, style)\r\n  }\r\n  return style\r\n}\r\n\r\n// Check if GeoJSON feature coordinates intersect the bounding box (WGS84)\r\nfunction geojsonFeatureIntersectsBounds(feature: any): boolean {\r\n  const geometry = feature.geometry\r\n  if (!geometry || !geometry.coordinates) return false\r\n\r\n  // Get coordinates based on geometry type\r\n  let coordinates: number[][] = []\r\n\r\n  if (geometry.type === 'LineString') {\r\n    coordinates = geometry.coordinates\r\n  } else if (geometry.type === 'MultiLineString') {\r\n    // Flatten all line coordinates\r\n    coordinates = geometry.coordinates.flat()\r\n  }\r\n\r\n  // Check if any coordinate is within bounds (GeoJSON is [lon, lat])\r\n  return coordinates.some((coord: number[]) => {\r\n    const [lon, lat] = coord\r\n    return lon >= BENELUX_BOUNDS.minLon &&\r\n           lon <= BENELUX_BOUNDS.maxLon &&\r\n           lat >= BENELUX_BOUNDS.minLat &&\r\n           lat <= BENELUX_BOUNDS.maxLat\r\n  })\r\n}\r\n\r\n/**\r\n * Romeinse wegen - filtered to Benelux + Rheinland region\r\n * Default layer for Detectie preset\r\n */\r\nexport async function createRomeinseWegenLayerOL() {\r\n  try {\r\n    const geojson = await loadGeoJSON('/detect/data/romeinse_wegen_itiner_e.geojson')\r\n\r\n    // Filter GeoJSON features BEFORE converting to OpenLayers (coordinates are still WGS84)\r\n    const filteredGeojson = {\r\n      type: 'FeatureCollection',\r\n      features: geojson.features.filter(geojsonFeatureIntersectsBounds)\r\n    }\r\n\r\n    // Now parse filtered features to OpenLayers format\r\n    const format = new GeoJSON({ featureProjection: 'EPSG:3857' })\r\n    const features = format.readFeatures(filteredGeojson)\r\n\r\n    const layer = new VectorLayer({\r\n      properties: { title: 'Romeinse wegen (regio)' },\r\n      source: new VectorSource({ features }),\r\n      style: (feature, resolution) => createStyle(resolution),\r\n      opacity: 0.8,\r\n      zIndex: 20\r\n    })\r\n\r\n    console.log(`✓ Romeinse wegen (regio) loaded (${features.length}/${geojson.features.length} features in Benelux region)`)\r\n    return layer\r\n\r\n  } catch (error) {\r\n    console.error('Failed to load Romeinse wegen layer:', error)\r\n    return null\r\n  }\r\n}\r\n\r\n/**\r\n * Romeinse wegen (Wereld) - complete world dataset\r\n * Optional layer for users who want to see the full network\r\n */\r\nexport async function createRomeinseWegenWereldLayerOL() {\r\n  try {\r\n    const geojson = await loadGeoJSON('/detect/data/romeinse_wegen_itiner_e.geojson')\r\n\r\n    const format = new GeoJSON({ featureProjection: 'EPSG:3857' })\r\n    const features = format.readFeatures(geojson)\r\n\r\n    const layer = new VectorLayer({\r\n      properties: { title: 'Romeinse wegen (Wereld)' },\r\n      source: new VectorSource({ features }),\r\n      style: (feature, resolution) => createStyle(resolution),\r\n      opacity: 0.8,\r\n      zIndex: 20\r\n    })\r\n\r\n    console.log(`✓ Romeinse wegen (Wereld) loaded (${features.length} features)`)\r\n    return layer\r\n\r\n  } catch (error) {\r\n    console.error('Failed to load Romeinse wegen (Wereld) layer:', error)\r\n    return null\r\n  }\r\n}\r\n"],"names":["BENELUX_BOUNDS","styleCache","getLineWidth","resolution","createStyle","width","cacheKey","style","Style","Stroke","geojsonFeatureIntersectsBounds","feature","geometry","coordinates","coord","lon","lat","createRomeinseWegenLayerOL","geojson","loadGeoJSON","filteredGeojson","features","GeoJSON","layer","VectorLayer","VectorSource","error","createRomeinseWegenWereldLayerOL"],"mappings":"2EAgBA,MAAMA,EAAiB,CACrB,OAAQ,IACR,OAAQ,KACR,OAAQ,GACR,OAAQ,EACV,EAGMC,MAAiB,IAEvB,SAASC,EAAaC,EAA4B,CAEhD,OAAIA,EAAa,IAAY,GACzBA,EAAa,IAAY,IACzBA,EAAa,GAAW,EACxBA,EAAa,GAAW,IACxBA,EAAa,GAAW,EACxBA,EAAa,GAAW,IACrB,CACT,CAEA,SAASC,EAAYD,EAA2B,CAC9C,MAAME,EAAQH,EAAaC,CAAU,EAC/BG,EAAW,SAASD,CAAK,GAE/B,IAAIE,EAAQN,EAAW,IAAIK,CAAQ,EACnC,OAAKC,IACHA,EAAQ,IAAIC,EAAM,CAChB,OAAQ,IAAIC,EAAO,CACjB,MAAO,UACP,MAAAJ,CAAA,CACD,CAAA,CACF,EACDJ,EAAW,IAAIK,EAAUC,CAAK,GAEzBA,CACT,CAGA,SAASG,EAA+BC,EAAuB,CAC7D,MAAMC,EAAWD,EAAQ,SACzB,GAAI,CAACC,GAAY,CAACA,EAAS,YAAa,MAAO,GAG/C,IAAIC,EAA0B,CAAA,EAE9B,OAAID,EAAS,OAAS,aACpBC,EAAcD,EAAS,YACdA,EAAS,OAAS,oBAE3BC,EAAcD,EAAS,YAAY,KAAA,GAI9BC,EAAY,KAAMC,GAAoB,CAC3C,KAAM,CAACC,EAAKC,CAAG,EAAIF,EACnB,OAAOC,GAAOf,EAAe,QACtBe,GAAOf,EAAe,QACtBgB,GAAOhB,EAAe,QACtBgB,GAAOhB,EAAe,MAC/B,CAAC,CACH,CAMA,eAAsBiB,GAA6B,CACjD,GAAI,CACF,MAAMC,EAAU,MAAMC,EAAY,8CAA8C,EAG1EC,EAAkB,CACtB,KAAM,oBACN,SAAUF,EAAQ,SAAS,OAAOR,CAA8B,CAAA,EAK5DW,EADS,IAAIC,EAAQ,CAAE,kBAAmB,YAAa,EACrC,aAAaF,CAAe,EAE9CG,EAAQ,IAAIC,EAAY,CAC5B,WAAY,CAAE,MAAO,wBAAA,EACrB,OAAQ,IAAIC,EAAa,CAAE,SAAAJ,EAAU,EACrC,MAAO,CAACV,EAASR,IAAeC,EAAYD,CAAU,EACtD,QAAS,GACT,OAAQ,EAAA,CACT,EAED,eAAQ,IAAI,oCAAoCkB,EAAS,MAAM,IAAIH,EAAQ,SAAS,MAAM,8BAA8B,EACjHK,CAET,OAASG,EAAO,CACd,eAAQ,MAAM,uCAAwCA,CAAK,EACpD,IACT,CACF,CAMA,eAAsBC,GAAmC,CACvD,GAAI,CACF,MAAMT,EAAU,MAAMC,EAAY,8CAA8C,EAG1EE,EADS,IAAIC,EAAQ,CAAE,kBAAmB,YAAa,EACrC,aAAaJ,CAAO,EAEtCK,EAAQ,IAAIC,EAAY,CAC5B,WAAY,CAAE,MAAO,yBAAA,EACrB,OAAQ,IAAIC,EAAa,CAAE,SAAAJ,EAAU,EACrC,MAAO,CAACV,EAASR,IAAeC,EAAYD,CAAU,EACtD,QAAS,GACT,OAAQ,EAAA,CACT,EAED,eAAQ,IAAI,qCAAqCkB,EAAS,MAAM,YAAY,EACrEE,CAET,OAASG,EAAO,CACd,eAAQ,MAAM,gDAAiDA,CAAK,EAC7D,IACT,CACF"}
{"version":3,"mappings":";iQAIymC,MAACA,EAAEA,GAAG,CAAC,MAAM,EAAEA,EAAE,IAAIC,EAAE,cAAc,CAAC,CAAC,aAAa,CAAC,MAAM,GAAG,SAAS,EAAE,KAAK,mBAAmB,CAAC,WAAW,KAAK,MAAM,EAAE,EAAE,KAAK,yBAAyB,GAAG,KAAK,6BAA6B,GAAG,KAAK,4BAA4B,EAAE,CAAC,SAAS,CAAC,KAAK,WAAWC,EAAE,KAAK,UAAU,EAAE,KAAK,mBAAmB,WAAW,KAAK,KAAK,mBAAmB,MAAM,OAAO,CAAC,CAAC,IAAI,WAAWC,EAAE,CAACA,IAAI,KAAK,KAAK,YAAY,IAAI,KAAK,aAAa,aAAa,EAAE,KAAK,KAAK,aAAaA,CAAC,EAAE,CAAC,eAAeA,EAAEC,EAAEC,EAAE,CAAC,GAAGD,EAAE,OAAO,OAAO,IAAIE,EAAE,CAAC,GAAGF,EAAE,OAAO,OAAOC,GAAG,MAAM,CAAC,CAAC,CAAC,gBAAgBF,EAAEC,EAAE,CAACD,GAAG,KAAKC,EAAE,OAAOD,EAAE,GAAG,CAAC,MAAM,eAAeA,EAAEC,EAAE,CAAC,GAAG,KAAK,YAAY,GAAG,GAAG,CAAC,KAAK,CAAC,KAAKC,CAAC,EAAE,MAAKE,EAAA,IAAC,OAAO,4BAAsC,wCAAE,OAAOC,EAAEJ,CAAC,EAAE,MAAMC,EAAE,CAAC,SAAS,KAAK,eAAeF,EAAE,eAAe,aAAaA,EAAE,aAAa,aAAaA,EAAE,aAAa,mBAAmBA,EAAE,mBAAmB,mBAAmBA,EAAE,kBAAkB,EAAEC,CAAC,CAAC,OAAOC,EAAE,CAAC,MAAMI,EAAEJ,CAAC,GAAGK,EAAE,UAAU,IAAI,EAAE,KAAK,yBAAyB,KAAK,KAAK,KAAK,KAAK,EAAE,kBAAkB,KAAK,WAAW,EAAE;AAAA,IAAQL,CAAC,EAAE,EAAEA,CAAC,CAAC,CAAC,MAAM,8BAA8BF,EAAE,CAAC,KAAK,KAAK,2BAA2B,MAAM,KAAK,+BAA+BA,CAAC,EAAE,MAAM,IAAIQ,EAAE,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,MAAM,kBAAkBR,EAAEE,EAAE,CAAC,GAAG,CAACD,EAAE,sBAAsB,OAAO,KAAK,8BAA8BC,CAAC,EAAE,GAAG,KAAK,IAAI,GAAG,CAAC,KAAK,CAAC,SAAS,CAAC,KAAK,EAAE,SAASO,CAAC,EAAE,QAAQ,CAAC,WAAWC,CAAC,CAAC,EAAE,MAAM,KAAK,qBAAqBV,EAAEE,CAAC,EAAE,KAAK,KAAK,2BAA2B,CAAC,EAAE,KAAK,KAAK,+BAA+BO,CAAC,EAAE,KAAK,KAAK,8BAA8BC,CAAC,CAAC,OAAOD,EAAE,CAACD,EAAEC,CAAC,CAAC,CAAC,CAAC,MAAM,qBAAqBT,EAAEC,EAAE,CAAC,IAAIQ,EAAE,KAAK,WAAW,GAAG,CAACT,GAAG,CAACS,GAAG,CAACA,EAAE,QAAQA,EAAE,UAAU,OAAO,KAAK,6BAA6BR,CAAC,EAAE,MAAM,EAAE,CAACC,GAAG,eAAe,KAAK,GAAG,EAAES,EAAEX,IAAIS,EAAE,GAAG,GAAGE,GAAGF,EAAE,OAAO,KAAK,OAAO,KAAK,mBAAmBA,EAAE,CAAC,EAAE,IAAIF,EAAER,EAAE,GAAGY,EAAEJ,EAAEE,EAAE,OAAO,QAAS,IAAG,CAACF,EAAE,MAAMK,EAAE,KAAK,IAAIX,CAAC,CAAC,OAAOY,EAAE,CAACL,EAAEK,CAAC,CAAC,CAAC,GAAG,CAACN,GAAG,CAACO,EAAEP,EAAEE,EAAE,OAAO,GAAG,EAAE,OAAO,KAAK,6BAA6BR,CAAC,EAAE,GAAG,CAAC,MAAMD,EAAQC,GAAN,KAAQA,EAAE,OAAO,KAAKF,EAAE,MAAMG,GAAG,cAAc,GAAGK,CAAC,WAAW,CAAC,OAAO,GAAG,OAAOP,CAAC,CAAC,CAAE,OAAOa,EAAE,CAACL,EAAEK,CAAC,CAAC,CAAC,MAAMR,EAAE,GAAGC,EAAE,GAAGS,EAAE,GAAG,GAAG,CAAChB,EAAE,MAAM,CAAC,SAAS,CAAC,KAAKM,EAAE,SAASC,CAAC,EAAE,QAAQ,CAAC,WAAWS,CAAC,CAAC,EAAE,GAAG,CAAC,GAAGJ,EAAE,MAAMF,EAAE,OAAM,GAAIA,EAAE,IAAIN,EAAE,CAAC,GAAGH,EAAE,OAAO,CAAC,IAAIO,CAAC,CAAC,CAAC,EAAE,MAAME,EAAE,KAAKR,CAAC,GAAGQ,EAAE,OAAO,KAAK,OAAO,KAAK,mBAAmBA,EAAE,CAAC,CAAC,OAAOI,EAAE,CAACL,EAAEK,CAAC,CAAC,CAAC,MAAM,CAAC,SAAS,CAAC,KAAKR,EAAE,SAASC,CAAC,EAAE,QAAQ,CAAC,WAAWS,CAAC,CAAC,CAAC,CAAC,mBAAmBf,EAAEC,EAAE,CAAC,MAAMC,EAAEc,EAAEhB,CAAC,EAAE,OAAOC,IAAIC,EAAE,SAAS,KAAK,IAAIA,CAAC,CAAC,MAAM,6BAA6BF,EAAE,CAAC,IAAIC,EAAE,GAAG,GAAG,CAACA,EAAE,MAAM,KAAK,+BAA+BD,CAAC,CAAC,OAAOE,EAAE,CAACM,EAAEN,CAAC,CAAC,CAAC,MAAM,CAAC,SAAS,CAAC,KAAKD,EAAE,SAAS,EAAE,EAAE,QAAQ,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC,MAAM,+BAA+BD,EAAE,CAAC,MAAMC,EAAE,KAAK,IAAIC,GAAG,eAAe,KAAK,GAAG,EAAE,KAAK,GAAG,CAACD,EAAE,SAAS,MAAMQ,EAAEQ,EAAE,aAAahB,EAAEgB,EAAE,KAAK,MAAM,KAAK,kBAAkBjB,CAAC,EAAE,OAAOiB,EAAE,WAAWhB,EAAEgB,EAAE,KAAKR,EAAQA,GAAG,YAAT,MAAqBA,EAAE,WAAW,SAAS,oBAAoB,CAAC,CAAC,MAAM,kBAAkBT,EAAE,CAAC,MAAMC,EAAE,KAAK,YAAY,QAAQ,KAAK,GAAGA,EAAE,OAAOA,EAAE,MAAMU,EAAET,GAAG,eAAe,KAAK,KAAK,EAAE,EAAE,GAAG,CAACS,GAAG,gBAAgB,OAAO,KAAK,MAAMJ,EAAE,GAAGI,EAAE,eAAe,gBAAgBZ,EAAEmB,EAAE,aAAa,GAAGnB,GAAGA,EAAE,QAAQc,EAAEd,EAAE,OAAO,IAAIc,EAAEN,CAAC,EAAE,OAAOR,EAAE,KAAK,MAAMM,EAAE,GAAGE,CAAC,kBAAkBD,EAAQN,GAAN,KAAQA,EAAE,OAAO,KAAKQ,EAAE,MAAME,EAAED,EAAEJ,EAAE,CAAC,SAAS,YAAY,MAAM,CAAC,EAAE,MAAM,EAAE,OAAOC,CAAC,CAAC,CAAC,EAAE,OAAOE,EAAE,GAAGW,EAAE,SAASX,EAAE,MAAM,IAAI,EAAE,IAAI,CAAC,KAAKR,EAAEC,EAAE,CAACA,IAAIA,EAAE,MAAM,MAAM,MAAM,KAAKD,EAAEC,CAAC,CAAC,CAAC,MAAMD,EAAEC,EAAE,CAAC,MAAMC,EAAED,GAAG,OAAOQ,EAAE,KAAK,YAAY,KAAK,KAAK,WAAW,QAAQS,EAAE,cAAc,OAAOhB,GAAGO,GAAG,CAACM,EAAEN,EAAE,QAAQP,EAAE,OAAO,GAAGD,EAAE,UAAUA,EAAE,SAAS,KAAK,IAAIU,EAAE,qBAAqB,cAAc,KAAK,KAAK,KAAK,KAAK,EAAE,gNAAgN,CAAC,MAAM,IAAI,CAAC,CAAC,EAAE,MAAM,MAAM,MAAMX,EAAE,CAAC,GAAGC,EAAE,MAAM,IAAI,CAAC,CAAC,CAAC,EAAE,OAAOD,EAAE,CAACoB,EAAE,CAAC,KAAKjB,CAAC,CAAC,CAAC,EAAEL,EAAE,UAAU,aAAa,IAAI,EAAEE,EAAE,CAACqB,EAAE,eAAe,aAAa,CAAC,QAAQ,CAAC,CAAC,EAAEvB,EAAE,UAAU,iBAAiB,IAAI,EAAEE,EAAE,CAACsB,EAAE,eAAe,aAAa,CAAC,OAAO,CAAC,KAAK,MAAM,CAAC,CAAC,CAAC,EAAExB,EAAE,UAAU,kBAAkB,IAAI,EAAEE,EAAE,CAACoB,EAAE,CAAC,SAAS,EAAE,CAAC,CAAC,EAAEtB,EAAE,UAAU,qBAAqB,MAAM,EAAEE,EAAE,CAACoB,EAAE,CAAC,KAAK,QAAQ,SAAS,EAAE,CAAC,CAAC,EAAEtB,EAAE,UAAU,2BAA2B,MAAM,EAAEE,EAAE,CAACoB,EAAE,CAAC,KAAK,QAAQ,SAAS,EAAE,CAAC,CAAC,EAAEtB,EAAE,UAAU,+BAA+B,MAAM,EAAEE,EAAE,CAACoB,EAAE,CAAC,KAAK,QAAQ,SAAS,EAAE,CAAC,CAAC,EAAEtB,EAAE,UAAU,8BAA8B,MAAM,EAAEA,EAAEE,EAAE,CAACuB,EAAE,gCAAgC,CAAC,EAAEzB,CAAC,EAAEA,CAAC,EAAEmB,EAAE,CAAC,WAAW,KAAK,KAAK,IAAI","names":["j","b","l","e","t","r","P","__vitePreload","n","p","a","u","s","i","o","I","m","c","d","w","E","v","U","h","f","y","g"],"ignoreList":[0],"sources":["../../node_modules/@arcgis/core/layers/mixins/PortalLayer.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{__decorate as e}from\"tslib\";import t from\"../../config.js\";import{id as r}from\"../../kernel.js\";import s from\"../../request.js\";import{result as i}from\"../../core/asyncUtils.js\";import o from\"../../core/Error.js\";import a from\"../../core/Logger.js\";import{destroyMaybe as l}from\"../../core/maybe.js\";import{throwIfAborted as n,isAbortError as p,throwIfAbortError as u}from\"../../core/promiseUtils.js\";import{hasSameCanonicalPortal as c,hasSamePortal as d,normalize as m}from\"../../core/urlUtils.js\";import{property as h}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/RandomLCG.js\";import{reader as f}from\"../../core/accessorSupport/decorators/reader.js\";import{subclass as g}from\"../../core/accessorSupport/decorators/subclass.js\";import{writer as y}from\"../../core/accessorSupport/decorators/writer.js\";import{getOwningPortalUrl as I}from\"../support/layerUtils.js\";import v from\"../../portal/Portal.js\";import P from\"../../portal/PortalItem.js\";import U from\"../../portal/PortalUser.js\";import{getUserPrivileges as w}from\"../../portal/support/portalItemUtils.js\";const j=j=>{const _=j;let b=class extends _{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=l(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(e){e!==this._get(\"portalItem\")&&(this.removeOrigin(\"portal-item\"),this._set(\"portalItem\",e))}readPortalItem(e,t,r){if(t.itemId)return new P({id:t.itemId,portal:r?.portal})}writePortalItem(e,t){e?.id&&(t.itemId=e.id)}async loadFromPortal(e,t){if(this.portalItem?.id)try{const{load:r}=await import(\"../../portal/support/layersLoader.js\");return n(t),await r({instance:this,supportedTypes:e.supportedTypes,validateItem:e.validateItem,supportsData:e.supportsData,layerModuleTypeMap:e.layerModuleTypeMap,populateGroupLayer:e.populateGroupLayer},t)}catch(r){throw p(r)||a.getLogger(this).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})\\n  ${r}`),r}}async finishLoadEditablePortalLayer(e){this._set(\"userHasEditingPrivileges\",await this._fetchUserHasEditingPrivileges(e).catch(e=>(u(e),!0)))}async setUserPrivileges(e,r){if(!t.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(r);if(this.url)try{const{features:{edit:t,fullEdit:s},content:{updateItem:i}}=await this._fetchUserPrivileges(e,r);this._set(\"userHasEditingPrivileges\",t),this._set(\"userHasFullEditingPrivileges\",s),this._set(\"userHasUpdateItemPrivileges\",i)}catch(s){u(s)}}async _fetchUserPrivileges(e,t){let s=this.portalItem;if(!e||!s||!s.loaded||s.sourceUrl)return this._fetchFallbackUserPrivileges(t);const i=!r?.findCredential(this.url),o=e===s.id;if(o&&s.portal.user)return this._getUserPrivileges(s,i);let a,l;if(o)a=s.portal.url;else try{a=await I(this.url,t)}catch(m){u(m)}if(!a||!c(a,s.portal.url))return this._fetchFallbackUserPrivileges(t);try{const e=null!=t?t.signal:null;l=await(r?.getCredential(`${a}/sharing`,{prompt:!1,signal:e}))}catch(m){u(m)}const n=!0,p=!1,d=!1;if(!l)return{features:{edit:n,fullEdit:p},content:{updateItem:d}};try{if(o?await s.reload():(s=new P({id:e,portal:{url:a}}),await s.load(t)),s.portal.user)return this._getUserPrivileges(s,i)}catch(m){u(m)}return{features:{edit:n,fullEdit:p},content:{updateItem:d}}}_getUserPrivileges(e,t){const r=w(e);return t&&(r.features.edit=!0),r}async _fetchFallbackUserPrivileges(e){let t=!0;try{t=await this._fetchUserHasEditingPrivileges(e)}catch(r){u(r)}return{features:{edit:t,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(e){const t=this.url?r?.findCredential(this.url):null;if(!t)return!0;const s=E.credential===t?E.user:await this._fetchEditingUser(e);return E.credential=t,E.user=s,null==s?.privileges||s.privileges.includes(\"features:user:edit\")}async _fetchEditingUser(e){const t=this.portalItem?.portal?.user;if(t)return t;const o=r?.findServerInfo(this.url??\"\");if(!o?.owningSystemUrl)return null;const a=`${o.owningSystemUrl}/sharing/rest`,l=v.getDefault();if(l&&l.loaded&&m(l.restUrl)===m(a))return l.user;const n=`${a}/community/self`,p=null!=e?e.signal:null,u=await i(s(n,{authMode:\"no-prompt\",query:{f:\"json\"},signal:p}));return u.ok?U.fromJSON(u.value.data):null}read(e,t){t&&(t.layer=this),super.read(e,t)}write(e,t){const r=t?.portal,s=this.portalItem?.id&&(this.portalItem.portal||v.getDefault());return r&&s&&!d(s.restUrl,r.restUrl)?(t.messages&&t.messages.push(new o(\"layer:cross-portal\",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(e,{...t,layer:this})}};return e([h({type:P})],b.prototype,\"portalItem\",null),e([f(\"web-document\",\"portalItem\",[\"itemId\"])],b.prototype,\"readPortalItem\",null),e([y(\"web-document\",\"portalItem\",{itemId:{type:String}})],b.prototype,\"writePortalItem\",null),e([h({clonable:!1})],b.prototype,\"resourceReferences\",void 0),e([h({type:Boolean,readOnly:!0})],b.prototype,\"userHasEditingPrivileges\",void 0),e([h({type:Boolean,readOnly:!0})],b.prototype,\"userHasFullEditingPrivileges\",void 0),e([h({type:Boolean,readOnly:!0})],b.prototype,\"userHasUpdateItemPrivileges\",void 0),b=e([g(\"esri.layers.mixins.PortalLayer\")],b),b},E={credential:null,user:null};export{j as PortalLayer};\n"],"file":"PortalLayer-CXdvrrFU.js"}
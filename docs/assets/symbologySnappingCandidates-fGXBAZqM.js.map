{"version":3,"file":"symbologySnappingCandidates-fGXBAZqM.js","sources":["../../node_modules/@arcgis/core/views/interactive/snapping/featureSources/snappingCandidateElevationAlignment.js","../../node_modules/@arcgis/core/views/interactive/snapping/featureSources/snappingCandidateElevationFilter.js","../../node_modules/@arcgis/core/views/interactive/snapping/featureSources/symbologySnappingCandidates.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport\"../../../../core/has.js\";import{LRUCache as e}from\"../../../../core/LRUCache.js\";import{getOrCreateMapValue as t}from\"../../../../core/MapUtils.js\";import{throwIfAborted as s}from\"../../../../core/promiseUtils.js\";import{getMetersPerVerticalUnitForSR as n}from\"../../../../core/unitUtils.js\";import{getMetersPerUnit as o}from\"../../../../symbols/support/unitConversionUtils.js\";function i(e=!1,t){if(e){const{elevationInfo:e,alignPointsInFeatures:s}=t;return new c(e,s)}return new a}class a{async alignCandidates(e,t,s){return e}notifyElevationSourceChange(){}}const r=1024;class c{constructor(t,s){this._elevationInfo=t,this._alignPointsInFeatures=s,this._alignmentsCache=new e(r),this._cacheVersion=0}async alignCandidates(e,t,s){const n=this._elevationInfo;return null==n||\"absolute-height\"!==n.mode||n.featureExpressionInfo?this._alignComputedElevationCandidates(e,t,s):(l(e,t,n),e)}notifyElevationSourceChange(){this._alignmentsCache.clear(),this._cacheVersion++}async _alignComputedElevationCandidates(e,n,o){const i=new Map;for(const s of e)t(i,s.objectId,d).push(s);const[a,r,c]=this._prepareQuery(i,n),h=await this._alignPointsInFeatures(a,o);s(o);if(c!==this._cacheVersion)return this._alignComputedElevationCandidates(e,n,o);this._applyCacheAndResponse(a,h,r);const{drapedObjectIds:u,failedObjectIds:l}=h,p=[];for(const t of e){const{objectId:e}=t;u.has(e)&&\"edge\"===t.type&&(t.draped=!0),l.has(e)||p.push(t)}return p}_prepareQuery(e,t){const s=[],n=[];for(const[o,i]of e){const e=[];for(const t of i)this._addToQueriesOrCachedResult(o,t.target,e,n),\"edge\"===t.type&&(this._addToQueriesOrCachedResult(o,t.start,e,n),this._addToQueriesOrCachedResult(o,t.end,e,n));0!==e.length&&s.push({objectId:o,points:e})}return[{spatialReference:t.toJSON(),pointsInFeatures:s},n,this._cacheVersion]}_addToQueriesOrCachedResult(e,t,s,n){const o=u(e,t),i=this._alignmentsCache.get(o);null==i?s.push(t):n.push(new h(t,i))}_applyCacheAndResponse(e,{elevations:t,drapedObjectIds:s,failedObjectIds:n},o){for(const r of o)r.apply();let i=0;const a=this._alignmentsCache;for(const{objectId:r,points:c}of e.pointsInFeatures){if(n.has(r)){i+=c.length;continue}const e=!s.has(r);for(const s of c){const n=u(r,s),o=t[i++];s.z=o,e&&a.put(n,o,1)}}}}class h{constructor(e,t){this.point=e,this.z=t}apply(){this.point.z=this.z}}function u(e,{x:t,y:s,z:n,spatialReference:o}){return`${e}-${t}-${s}-${n??0}}-wkid:${o?.wkid}`}function l(e,t,s){const{offset:i,unit:a}=s;if(null==i)return;const r=n(t),c=i*(o(a??\"meters\")/r);for(const n of e)switch(n.type){case\"edge\":n.start.z+=c,n.end.z+=c;continue;case\"vertex\":n.target.z+=c;continue}}function d(){return[]}export{i as getSnappingCandidateElevationAligner};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport\"../../../../core/has.js\";class t{filter(t,n){return n}notifyElevationSourceChange(){}}class n{filter(t,n){const{point:r,distance:c}=t,{z:i}=r;if(!(null!=i))return n;if(0===n.length)return n;const o=s(c),u=this._updateCandidatesTo3D(n,r,o).filter(e);return u.sort(a),u}_updateCandidatesTo3D(t,n,e){for(const r of t)switch(r.type){case\"edge\":c(r,n,e);continue;case\"vertex\":o(r,n,e);continue}return t}}function e(t){return t.distance<=1}function r(e=!1){return e?new n:new t}function c(t,n,{x:e,y:r,z:c}){const{start:o,end:s,target:a}=t;t.draped||i(a,n,o,s);const u=(n.x-a.x)/e,d=(n.y-a.y)/r,f=(n.z-a.z)/c;t.distance=Math.sqrt(u*u+d*d+f*f)}function i(t,n,e,r){const c=r.x-e.x,i=r.y-e.y,o=r.z-e.z,s=c*c+i*i+o*o,a=(n.x-e.x)*c+(n.y-e.y)*i+o*(n.z-e.z),u=Math.min(1,Math.max(0,a/s)),d=e.x+c*u,f=e.y+i*u,x=e.z+o*u;t.x=d,t.y=f,t.z=x}function o(t,n,{x:e,y:r,z:c}){const{target:i}=t,o=(n.x-i.x)/e,s=(n.y-i.y)/r,a=(n.z-i.z)/c,u=Math.sqrt(o*o+s*s+a*a);t.distance=u}function s(t){return\"number\"==typeof t?{x:t,y:t,z:t}:t}function a(t,n){return t.distance-n.distance}export{r as getSnappingCandidateElevationFilter};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport\"../../../../core/has.js\";import{clone as t}from\"../../../../core/lang.js\";import{LRUCache as e}from\"../../../../core/LRUCache.js\";import{throwIfAborted as s}from\"../../../../core/promiseUtils.js\";import{numericHash as o}from\"../../../../core/string.js\";function n(t=!1,e){return t?new i(e):new c}class c{async fetch(){return[]}notifySymbologyChange(){}}const r=1024;class i{constructor(t){this._getSymbologyCandidates=t,this._candidatesCache=new e(r),this._cacheVersion=0}async fetch(e,o){if(0===e.length)return[];const n=[],c=[],r=this._candidatesCache;for(const s of e){const e=a(s),o=r.get(e);if(o)for(const s of o)c.push(t(s));else n.push(s),r.put(e,[],1)}if(0===n.length)return c;const i=this._cacheVersion,{candidates:h,sourceCandidateIndices:d}=await this._getSymbologyCandidates(n,o);s(o);if(i!==this._cacheVersion)return this.fetch(e,o);const f=[],{length:g}=h;for(let s=0;s<g;++s){const e=h[s],o=a(n[d[s]]),c=r.get(o);c.push(e),r.put(o,c,c.length),f.push(t(e))}return c.concat(f)}notifySymbologyChange(){this._candidatesCache.clear(),this._cacheVersion++}}function a(t){switch(t.type){case\"vertex\":{const{objectId:e,target:s}=t,n=`${e}-vertex-${s.x}-${s.y}-${s.z??0}`;return o(n).toString()}case\"edge\":{const{objectId:e,start:s,end:n}=t,c=`${e}-edge-${s.x}-${s.y}-${s.z??0}-to-${n.x}-${n.y}-${n.z??0}`;return o(c).toString()}default:return\"\"}}export{n as getSymbologySnappingCandidatesFetcher};\n"],"names":["i","e","t","s","c","a","a$2","r","n","l","o","d","h","u","p","n$1","f","x","g"],"mappings":"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","x_google_ignoreList":[0,1,2]}
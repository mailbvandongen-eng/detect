{"version":3,"file":"OverlayContainer-CVs1lxJJ.js","sources":["../../node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/shaders/OverlayShader.js","../../node_modules/@arcgis/core/views/2d/engine/webgl/shaderGraph/techniques/overlay/OverlayTechnique.js","../../node_modules/@arcgis/core/views/2d/engine/webgl/OverlayContainer.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{__decorate as t,__param as o}from\"tslib\";import{GraphShaderModule as e,FragmentOutput as r,location as p,uniform as i,input as s,VertexInput as n,UniformGroup as d,FragmentInput as l}from\"../../GraphShaderModule.js\";import{Float as v,dot as a,Vec3 as y,Vec2 as c,Vec4 as u,texture2D as f,Mat3 as h,Sampler2D as m}from\"../../graph/glsl.js\";class x extends n{}t([p(0,c)],x.prototype,\"pos\",void 0),t([p(1,c)],x.prototype,\"uv\",void 0);class g extends l{}class w extends d{}t([i(h)],w.prototype,\"dvs\",void 0);class S extends d{}t([i(c)],S.prototype,\"perspective\",void 0),t([i(c)],S.prototype,\"texSize\",void 0),t([i(v)],S.prototype,\"wrapAroundShift\",void 0),t([i(v)],S.prototype,\"opacity\",void 0),t([i(m)],S.prototype,\"texture\",void 0);class j extends e{constructor(){super(...arguments),this.type=\"OverlayShader\"}vertex(t){const o=t.uv.divide(this.config.texSize),e=new v(1).add(a(o,this.config.perspective)),r=new y(t.pos.add(new c(this.config.wrapAroundShift,0)),1),p=this.transform.dvs.multiply(r);return{uv:o,glPosition:new u(p.xy.multiply(e),0,e)}}fragment(t){const o=f(this.config.texture,t.uv).multiply(this.config.opacity),e=new r;return e.fragColor=o,e}}t([i(w)],j.prototype,\"transform\",void 0),t([i(S)],j.prototype,\"config\",void 0),t([o(0,s(x))],j.prototype,\"vertex\",null),t([o(0,s(g))],j.prototype,\"fragment\",null);export{j as OverlayShader};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{destroyMaybe as e}from\"../../../../../../../core/maybe.js\";import{Mesh as t}from\"../../../meshing/Mesh.js\";import{simplePipelineState as s}from\"../../utils.js\";import{Technique as i}from\"../Technique.js\";import{OverlayShader as r}from\"../shaders/OverlayShader.js\";import{PrimitiveType as n,DataType as o}from\"../../../../../../webgl/enums.js\";import{VertexElementDescriptor as a}from\"../../../../../../webgl/VertexElementDescriptor.js\";class h extends i{constructor(){super(...arguments),this.type=25,this._mesh=null,this.shaders={overlay:new r}}render(e,t){const{context:i,painter:r}=e,n=this._getMesh(e,t);r.setPipelineState(s);const{isWrapAround:o,wrapAroundShift:a}=t.config,h={...t.config,wrapAroundShift:0},p={shader:this.shaders.overlay,uniforms:{transform:t.transform,config:h},defines:null,optionalAttributes:null,useComputeBuffer:!1};r.setPipelineState({...s,stencil:{write:!1,test:{compare:514,op:{fail:7680,zFail:7680,zPass:7681},mask:255}}}),r.submitDrawMeshUntyped(i,p,n,{stencilRef:0}),o&&(h.wrapAroundShift=a,r.submitDrawMeshUntyped(i,p,n,{stencilRef:0}))}shutdown(){e(this._mesh)}_getMesh(e,s){const{context:i}=e;if(this._mesh){const e=this._mesh.vertexBuffers.get(\"positions\");if(!e)throw new Error(\"Buffer not found\");e.setData(s.position)}else{const e=null!=s.index?s.index.length:s.position.length/2;this._mesh=new t(i,{vertex:{positions:{data:s.position,layout:[new a(\"pos\",2,o.FLOAT,0,8)]},uvs:{data:s.tex,layout:[new a(\"uv\",2,o.UNSIGNED_SHORT,0,4)]}},index:null!=s.index?{index:{data:s.index}}:void 0,groups:[{index:null!=s.index?\"index\":void 0,primitive:n.TRIANGLE_STRIP}],parts:[{group:0,start:0,count:e}]})}return this._mesh}}export{h as OverlayTechnique};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{toRadian as t}from\"../../../../core/libs/gl-matrix-2/math/common.js\";import{identity as e,multiply as r,translate as i,scale as o,rotate as s}from\"../../../../core/libs/gl-matrix-2/math/mat3.js\";import{create as a}from\"../../../../core/libs/gl-matrix-2/factories/mat3f32.js\";import{fromValues as n}from\"../../../../core/libs/gl-matrix-2/factories/vec2f32.js\";import{fromValues as l}from\"../../../../core/libs/gl-matrix-2/factories/vec3f32.js\";import{normalizeMapX as c}from\"../../../../geometry/support/normalizeUtils.js\";import{getInfo as h}from\"../../../../geometry/support/spatialReferenceUtils.js\";import{getWorldWidth as d}from\"../../viewpointUtils.js\";import m from\"./WGLContainer.js\";import{OverlayTechnique as p}from\"./shaderGraph/techniques/overlay/OverlayTechnique.js\";class f extends m{constructor(){super(...arguments),this._viewStateId=-1,this._dvsMat3=a(),this._overlayTechnique=new p}get dvsMat3(){return this._dvsMat3}beforeRender(t){this._updateMatrices(t),this._updateOverlays(t,this.children);for(const e of this.children)e.beforeRender(t)}doRender(t){if(1!==t.drawPhase||!this.visible)return;super.doRender(t);const e=this._overlayTechnique;for(const r of this.children)r.draw(t,e)}onDetach(){this._overlayTechnique.shutdown()}_updateMatrices(a){const{state:h}=a,{id:d,size:m,pixelRatio:p,resolution:f,rotation:u,viewpoint:v,displayMat3:_}=h;if(this._viewStateId===d)return;const g=t(u),y=p*m[0],M=p*m[1];this._localOrigin=v.targetGeometry.clone();const{x:w,y:x}=this._localOrigin,b=c(w,h.spatialReference);this._localOrigin.x=b,this._localOrigin.y=x;const j=f*y,O=f*M,R=e(this._dvsMat3);r(R,R,_),i(R,R,n(y/2,M/2)),o(R,R,l(y/j,-M/O,1)),s(R,R,-g),this._viewStateId=d}_updateOverlays(e,r){const{state:i}=e,{rotation:o,spatialReference:s,worldScreenWidth:a,size:n,viewpoint:l}=i,c=this._localOrigin;let m,p=0;const f=h(s);if(f&&s.isWrappable){const e=n[0],r=n[1],c=t(o),h=Math.abs(Math.cos(c)),u=Math.abs(Math.sin(c)),v=Math.round(e*h+r*u),[_,g]=f.valid,y=d(s),{x:M,y:w}=l.targetGeometry,x=[M,w],b=[0,0];i.toScreen(b,x);const j=[0,0];let O;O=v>a?.5*a:.5*v;const R=Math.floor((M+.5*y)/y),q=_+R*y,S=g+R*y,G=[b[0]+O,0];i.toMap(j,G),j[0]>S&&(p=y),G[0]=b[0]-O,i.toMap(j,G),j[0]<q&&(p=-y),m={worldWidth:y,xBounds:[_,g]}}for(const t of r)t.updateDrawCoords(c,p,i,m)}}export{f as default};\n"],"names":["x","n","t","p","c","g","l","w","d","i","h","S","v","m","j","e","o","a","r","y","u","f","s","_","M","b","O","R","q","G"],"mappings":"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","x_google_ignoreList":[0,1,2]}
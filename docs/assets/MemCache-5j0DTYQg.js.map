{"version":3,"file":"MemCache-5j0DTYQg.js","sources":["../../node_modules/@arcgis/core/core/MemCache.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport has from\"./has.js\";const t=-3,s=t-1,i=!!has(\"esri-tests-disable-gpu-memory-measurements\");class e{constructor(t,s,i,e=0){this.name=t,this._storage=s,this.removeFunc=i,this._defaultPriority=e,this.id=`${o++}${n}`,this.size=0,this._hit=0,this._miss=0,this._storage.register(this)}destroy(){this._storage.deregister(this),this._storage=r}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(t){return this._storage.getSize(this,t)}set maxSize(t){this._storage.setMaxSize(this,t)}resetHitRate(){this._hit=this._miss=0}put(t,s,i=this._defaultPriority){this._storage.put(this,t,s,s.usedMemory,i)}pop(t){const s=this._storage.pop(this,t);return void 0===s?++this._miss:++this._hit,s}get(t){const s=this._storage.get(this,t);return void 0===s?++this._miss:++this._hit,s}peek(t){return this._storage.peek(this,t)}updateSize(t){this._storage.updateSize(this,t)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}*[Symbol.iterator](){yield*this._storage.values(this)}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}}class h{get size(){return this._size}constructor(t=10485760){this._maxSize=t,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._users=new Map,this._sizeLimits=new Map}destroy(){this.clearAll(),this._sizeLimits.clear(),this._users.clear(),this._db=null}register(t){this._users.set(t.id.slice(0,-1),t)}deregister(t){this.clear(t),this._sizeLimits.delete(t),this._users.delete(t.id.slice(0,-1))}get maxSize(){return this._maxSize}set maxSize(t){this._maxSize=Math.max(t,-1),this._checkSize()}getSize(t,s){const i=this._db.get(t.id+s);return i?.size??0}put(e,h,r,o,n){h=e.id+h;const a=this._db.get(h);if(a&&(this._size-=a.size,e.size-=a.size,this._db.delete(h),a.entry!==r&&this._notifyRemove(h,a.entry,a.size,0)),o>this._maxSize)return void this._notifyRemove(h,r,o,0);if(void 0===r)return void console.warn(\"Refusing to cache undefined entry \");if(!o||o<0)return i||console.warn(`Refusing to cache entry with size ${o} for key ${h}`),void this._notifyRemove(h,r,0,0);const c=1+Math.max(n,s)-t;this._db.set(h,new _(r,o,c)),this._size+=o,e.size+=o,this._checkSize()}updateSize(t,s){s=t.id+s;const i=this._db.get(s);if(!i)return;this._size-=i.size,t.size-=i.size;let e=i.entry.usedMemory;for(;e>this._maxSize;){const t=this._notifyRemove(s,i.entry,e,1);if(!(null!=t&&t>0))return void this._db.delete(s);e=t}i.size=e,this._size+=e,t.size+=e,this._checkSize()}pop(t,s){s=t.id+s;const i=this._db.get(s);if(i)return this._size-=i.size,t.size-=i.size,this._db.delete(s),++this._hit,i.entry;++this._miss}get(t,s){s=t.id+s;const i=this._db.get(s);if(void 0!==i)return this._db.delete(s),i.lives=i.lifetime,this._db.set(s,i),++this._hit,i.entry;++this._miss}peek(t,s){const i=this._db.get(t.id+s);return i?++this._hit:++this._miss,i?.entry}get performanceInfo(){const s={Size:Math.round(this._size/1048576)+\"/\"+Math.round(this._maxSize/1048576)+\"MB\",\"Hit rate\":Math.round(100*this._getHitRate())+\"%\",Entries:this._db.size.toString()},i={},e=new Array;this._db.forEach((t,s)=>{const h=t.lifetime;e[h]=(e[h]||0)+t.size,this._users.forEach(e=>{const{id:h,name:r}=e;if(s.startsWith(h)){const s=i[r]||0;i[r]=s+t.size}})});const h={};this._users.forEach(t=>{const s=t.name;if(\"hitRate\"in t&&\"number\"==typeof t.hitRate&&!isNaN(t.hitRate)&&t.hitRate>0){const e=i[s]||0;i[s]=e,h[s]=Math.round(100*t.hitRate)+\"%\"}else h[s]=\"0%\"});const r=Object.keys(i);r.sort((t,s)=>i[s]-i[t]),r.forEach(t=>s[t]=Math.round(i[t]/2**20)+\"MB / \"+h[t]);for(let o=e.length-1;o>=0;--o){const i=e[o];i&&(s[\"Priority \"+(o+t-1)]=Math.round(i/this._size*100)+\"%\")}return s}resetStats(){this._hit=this._miss=0,this._users.forEach(t=>t.resetHitRate())}clear(t){const s=t.id;this._db.forEach((t,i)=>{i.startsWith(s)&&(this._size-=t.size,this._db.delete(i),this._notifyRemove(i,t.entry,t.size,0))}),t.size=0}clearAll(){this._db.forEach((t,s)=>this._notifyRemove(s,t.entry,t.size,0)),this._users.forEach(t=>t.size=0),this._size=0,this._db.clear()}*values(t){for(const[s,i]of this._db)s.startsWith(t.id)&&(yield i.entry)}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(t,s,i,e){const h=this._users.get(t.split(n)[0])?.removeFunc,r=h?.(s,e,i);return\"number\"==typeof r?r:null}_checkSize(){this._sizeLimits.forEach((t,s)=>this._checkSizeLimits(t,s)),this._checkSizeLimits(this.maxSize)}setMaxSize(t,s){null==s||s<=0?this._sizeLimits.delete(t):this._sizeLimits.set(t,s)}_checkSizeLimits(t,s){const i=s??this;if(i.size<=t)return;const e=s?.id;let h=!0;for(;h;){h=!1;for(const[r,o]of this._db)if(0===o.lifetime&&(!e||r.startsWith(e))){const e=s??this._users.get(r.split(n)[0]);if(this._purgeItem(r,o,e),i.size<=.9*t)return;h||=this._db.has(r)}}for(const[r,o]of this._db)if(!e||r.startsWith(e)){const e=s??this._users.get(r.split(n)[0]);if(this._purgeItem(r,o,e),i.size<=.9*t)return}}_purgeItem(t,s,i){if(this._db.delete(t),s.lives<=1){this._size-=s.size,i&&(i.size-=s.size);const e=this._notifyRemove(t,s.entry,s.size,1);null!=e&&e>0&&(this._size+=e,i&&(i.size+=e),s.lives=s.lifetime,s.size=e,this._db.set(t,s))}else--s.lives,this._db.set(t,s)}}const r=new h(0);let o=0;class _{constructor(t,s,i){this.entry=t,this.size=s,this.lifetime=i,this.lives=i}}const n=\":\";export{e as MemCache,h as MemCacheStorage,t as MinPriority,s as NoPriority};\n"],"names":["t","s","i","has","h","r","o","a","c","_","e","n"],"mappings":"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","x_google_ignoreList":[0]}
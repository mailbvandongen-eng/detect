{"version":3,"file":"GridSnappingEngine-CLw2SaGS.js","sources":["../../node_modules/@arcgis/core/views/interactive/snapping/GridSnappingEngine.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{__decorate as t}from\"tslib\";import e from\"../../../core/Accessor.js\";import r from\"../../../core/Logger.js\";import{deg2rad as i}from\"../../../core/mathUtils.js\";import{convertUnit as n}from\"../../../core/unitUtils.js\";import{property as o}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/RandomLCG.js\";import{subclass as s}from\"../../../core/accessorSupport/decorators/subclass.js\";import{K as a}from\"../../../chunks/vec32.js\";import{isLoadedOrLoadFor as p,project as l}from\"../../../geometry/projectionUtils.js\";import{getClosestDenormalizedXToReference as c}from\"../../../geometry/support/normalizeUtils.js\";import{getResolutionForScale as u}from\"../../../geometry/support/scaleUtils.js\";import{minimumPixelsPerStrideForDisplayWhenScalingOff as d}from\"../../2d/grid/constants.js\";import{getScaleFactor as g,measureMetersPerUnitAtReferencePoint as f}from\"../../2d/grid/gridUtils.js\";import{create as h,createWritable as m}from\"../sketch/normalizedPoint.js\";import{gridPlacementGraphicSymbol as S}from\"./snappingUtils.js\";import{IntersectionSnappingCandidate as y}from\"./candidates/IntersectionSnappingCandidate.js\";import{LineSnappingCandidate as v}from\"./candidates/LineSnappingCandidate.js\";let w=class extends e{constructor(t){super(t),this.options=null}destroy(){this._set(\"options\",null)}get grid(){return this.view.grid}get effectiveViewRotation(){return this.grid?.rotateWithMap?0:i(this.view.rotation??0)}get gridRotation(){return i(this.grid?.rotation??0)}get gridCenter(){const{spatialReference:t,grid:e}=this;if(!e||!t||!p(e.center.spatialReference,t))return null;try{const r=l(e.center,t),i=t.isWrappable&&null!=this.view?.center?c(r.x,this.view.center.x,t):r.x;return h(i,r.y,r.z)}catch(i){return r.getLogger(this).errorOnce(\"Grid Snapping - Failed to project grid center.\",i),null}}get offsetScaleFactor(){const{pixelsPerStride:t,grid:e}=this;if(!e||!t)return 1;const{majorLineInterval:r,dynamicScaling:i}=e;return r<1?null:g(r,t,i)}get spatialReference(){return this.view.spatialReference}get gridMetersPerStride(){const{grid:t}=this;return t?n(t.spacing,t.units,\"meters\"):null}get viewMetersPerPixel(){const{viewMetersPerSRUnit:t}=this;return null==t?null:t*u(this.view.scale,this.view.spatialReference)}get viewMetersPerSRUnit(){const{spatialReference:t}=this.view;return this.gridCenter?f(this.gridCenter[0],this.gridCenter[1],t):null}get pixelsPerStride(){const{gridMetersPerStride:t,viewMetersPerPixel:e}=this;return e&&t?t/e:null}get updating(){return null!=this.grid&&null!=this.spatialReference&&null==this.viewMetersPerSRUnit}async fetchCandidates(t,e,r){const{options:i,view:n}=this;if(!i?.effectiveGridEnabled||!n.grid||r.feature?.attributes&&S in r.feature.attributes)return[];const o=r.coordinateHelper.arrayToPoint(t),s=i.distance*(\"touch\"===r.pointer?i.touchSensitivityMultiplier:1);return this.fetchCandidatesSync(o,s)}fetchCandidatesSync(t,e){const r=[],{grid:i,effectiveViewRotation:n,gridRotation:o,gridCenter:s,viewMetersPerPixel:a,viewMetersPerSRUnit:c,offsetScaleFactor:u,spatialReference:g,gridMetersPerStride:f,pixelsPerStride:m}=this;if(!(i&&a&&c&&s&&g&&u&&f&&m))return r;if(!i.dynamicScaling&&m<d)return r;if(!p(t.spatialReference,g))return r;const S=l(t,g),w=h(S.x,S.y,S.z),x=P(w,-o,s,-n),C=f/c*u,U=R(x,C,s),{shouldSnapX:b,shouldSnapY:L}=j(U,x,e,a,c);if(!b&&!L)return[];const z=h((b?U:x)[0],(L?U:x)[1]),E=P(z,o,s,n),F=P(U,o,s,n);if(L){const t=M(U,x,C,\"y\"),e=P(t,o,s,n);r.push(new v({lineStart:F,lineEnd:e,targetPoint:E,isDraped:!1}))}if(b){const t=M(U,x,C,\"x\"),e=P(t,o,s,n);r.push(new v({lineStart:F,lineEnd:e,targetPoint:E,isDraped:!1}))}return b&&L&&r.push(new y(E,r[0],r[1],!1)),r}};t([o({constructOnly:!0})],w.prototype,\"view\",void 0),t([o()],w.prototype,\"options\",void 0),t([o()],w.prototype,\"grid\",null),t([o()],w.prototype,\"effectiveViewRotation\",null),t([o()],w.prototype,\"gridRotation\",null),t([o()],w.prototype,\"gridCenter\",null),t([o()],w.prototype,\"offsetScaleFactor\",null),t([o()],w.prototype,\"spatialReference\",null),t([o()],w.prototype,\"gridMetersPerStride\",null),t([o()],w.prototype,\"viewMetersPerPixel\",null),t([o()],w.prototype,\"viewMetersPerSRUnit\",null),t([o()],w.prototype,\"pixelsPerStride\",null),t([o()],w.prototype,\"updating\",null),w=t([s(\"esri.views.interactive.snapping.GridSnappingEngine\")],w);const P=(t,e,r,i)=>{const n=m(t[0],t[1],t[2]);return a(n,a(n,n,r,e),r,i)},R=(t,e,r)=>{const i=(t[0]-r[0])/e,n=(t[1]-r[1])/e,o=Math.trunc(i),s=Math.trunc(n),a=Math.round(i%1),p=Math.round(n%1),l=r[0]+(o+a)*e,c=r[1]+(s+p)*e;return h(l,c)},j=(t,e,r,i,n)=>{if(i<=0)return{shouldSnapX:!1,shouldSnapY:!1};const o=(t[0]-e[0])/i,s=(t[1]-e[1])/i;return{shouldSnapX:Math.abs(o*n)<r,shouldSnapY:Math.abs(s*n)<r}},M=(t,e,r,i)=>{if(\"y\"===i){const i=e[0]>t[0]?1:-1;return h(t[0]+r*i,t[1])}const n=e[1]>t[1]?1:-1;return h(t[0],t[1]+r*n)};export{w as GridSnappingEngine};\n"],"names":["w","e","i","p","r","l","c","h","g","n","u","f","S","o","s","t","a","m","d","x","P","C","U","R","b","L","j","z","E","F","M","v","y"],"mappings":"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","x_google_ignoreList":[0]}